<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Источник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Приемник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Формула</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КолонкаИсточника</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Создать возврат от клиента</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string">ВозвратТоваровОтКлиента</Value>
		<Value xsi:type="xs:string">	ИмяДокументаПрименика = "Возврат товаров от клиента 1С";
	
	Отборы = Новый Структура("RETANN", Источник.Ссылка);
	Результат = ЭКОМ_ОбщегоНазначения.ПолучитьПоляЦепочкиДокументов("ЭКОМ_ЦепочкиДокументовПоставщика", "Накладная", Отборы);
	Если Результат.Успешно Тогда 
		Приемник.Заполнить(Результат.Накладная);
		Приемник.Дата = ТекущаяДата();
		
		Запрос 		 = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		               |	ЭКОМ_ДокументыТЧ_Товары.Номенклатура КАК Номенклатура,
		               |	ЭКОМ_ДокументыТЧ_Товары.КоличествоПринятое КАК Количество,
		               |	ЭКОМ_ДокументыТЧ_Товары.КоличествоПринятое КАК КоличествоУпаковок,
		               |	ЭКОМ_ДокументыТЧ_Товары.Цена КАК Цена,
		               |	ЭКОМ_ДокументыТЧ_Товары.Сумма КАК Сумма,
		               |	ЭКОМ_ДокументыТЧ_Товары.СуммаНДС КАК СуммаНДС,
		               |	ВЫБОР
		               |		КОГДА ЭКОМ_ДокументыТЧ_Товары.СтавкаНДС = 10
		               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
		               |		КОГДА ЭКОМ_ДокументыТЧ_Товары.СтавкаНДС = 18
		               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
		               |		КОГДА ЭКОМ_ДокументыТЧ_Товары.СтавкаНДС = 20
		               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20)
		               |		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
		               |	КОНЕЦ КАК СтавкаНДС,
		               |	ЭКОМ_ДокументыТЧ_Товары.ЕдиницаИзмерения КАК Упаковка,
		               |	ЭКОМ_ДокументыТЧ_Товары.Сумма_с_НДС КАК СуммаСНДС,
		               |	ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимости.ИзДокументаПродажи) КАК СпособОпределенияСебестоимости,
		               |	&amp;ДокументРеализации КАК ДокументРеализации
		               |ИЗ
		               |	Документ.ЭКОМ_Документы.ТЧ_Товары КАК ЭКОМ_ДокументыТЧ_Товары
		               |ГДЕ
		               |	ЭКОМ_ДокументыТЧ_Товары.Ссылка = &amp;Ссылка";
		Запрос.УстановитьПараметр("Ссылка", Источник.Ссылка);
		Запрос.УстановитьПараметр("ДокументРеализации", Результат.Накладная);
		Результат = Запрос.Выполнить();
		Приемник.Товары.Очистить();    
		Если Не Результат.Пустой() Тогда
			Выгрузка = Результат.Выгрузить();
			Приемник.Товары.Загрузить(Выгрузка);	
		КонецЕсли;
		
	    СтруктураПересчетаСуммы = ОбработкаТабличнойЧастиКлиентСервер.ПараметрыПересчетаСуммыНДСВТЧ(Приемник);
		 
		СтруктураДействий = Новый Структура;
	    СтруктураДействий.Вставить("ПересчитатьСумму", "КоличествоУпаковок");
	    СтруктураДействий.Вставить("ПересчитатьСуммуСНДС", СтруктураПересчетаСуммы);
	    СтруктураДействий.Вставить("ПересчитатьСуммуНДС", СтруктураПересчетаСуммы);
	    СтруктураДействий.Вставить("ЗаполнитьСтавкуНДС", Новый Структура("НалогообложениеНДС, Дата", Приемник.НалогообложениеНДС, Приемник.Дата));
	    СтруктураДействий.Вставить("ПересчитатьКоличествоУпаковок", ОбработкаТабличнойЧастиКлиентСервер.СтруктураПересчетаКоличестваУпаковок());    

	    ОбработкаТабличнойЧастиСервер.ОбработатьТЧ(Приемник.Товары, СтруктураДействий, Неопределено); 

		
		Приемник.СуммаДокумента = Приемник.Товары.Итог("СуммаСНДС");
		Если Приемник.РасшифровкаПлатежа.Количество() = 1 Тогда
			Приемник.РасшифровкаПлатежа[0].Сумма = Приемник.СуммаДокумента;
		Иначе
			Приемник.РасшифровкаПлатежа.Очистить();
			НовСтр = Приемник.РасшифровкаПлатежа.Добавить();
			НовСтр.ВалютаВзаиморасчетов = Приемник.Валюта;
			НовСТр.Заказ 			    = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Результат.Накладная, "ЗаказКлиента");
			НовСтр.Сумма 				= Приемник.СуммаДокумента;
		КонецЕсли;
			

		// Запись документа
		Если Приемник.Товары.Количество() = 0 Тогда
		    ТекстЛогаСобытий = "Документ " + ИмяДокументаПрименика + " по документу " + Строка(Источник.Ссылка) +
		    " не создан, т.к. не удалось заполнить табличную часть товары";
		    ЗаписатьЛогСобытий(ЛогСобытий, ТекстЛогаСобытий);
		Иначе    
		    Попытка
		        Приемник.Записать(РежимЗаписиДокумента.Запись);
		    Исключение               	       
		        ТекстЛогаСобытий = ИмяДокументаПрименика + " по документу " + Строка(Источник.Ссылка) + " не создан!!! " + СокрЛП(ОписаниеОшибки()); 
		        ЗаписатьЛогСобытий(ЛогСобытий, ТекстЛогаСобытий);
		    КонецПопытки;
		КонецЕсли;

	КонецЕсли; //Результат.Успешно</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">ЭКОМ_Документ_RETANN</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">-1</lastId>
		</Value>
	</row>
</ValueTree>