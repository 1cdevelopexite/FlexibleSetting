// Необходимо указать типы документов для конфигурации 1С БП 3.0
ИмяПоступления1С     = "Значение(Документ.ПоступлениеТоваровУслуг.ПустаяСсылка)";
ИмяЭКОМ_Документа    = "Значение(Документ.ЭКОМ_Документы.ПустаяСсылка)";
ИмяСчетФактуры1С     = "Значение(Документ.СчетФактураПолученный.ПустаяСсылка)";

ТекстЗапроса = "ВЫБРАТЬ
               |	ЭКОМ_ЦепочкаПокупателя.ORDERDATE КАК ДатаЗаказа,
               |	ЭКОМ_ЦепочкаПокупателя.ORDERNUMBER КАК НомерЗаказа,
               |	ЭКОМ_ЦепочкаПокупателя.Заказ КАК ДокументЗаказа,
               |	ЭКОМ_ЦепочкаПокупателя.ORDRSP КАК ЭКОМ_Документ_ORDRSP,
               |	ЭКОМ_ЦепочкаПокупателя.INVOICE КАК ЭКОМ_Документ_INVOICE,
               |	НЕ(ЭКОМ_ЦепочкаПокупателя.ORDRSP.Комментарий ЕСТЬ NULL
               |			ИЛИ (ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.ORDRSP.Комментарий КАК СТРОКА(10))) = """") КАК ЭКОМ_Документ_ORDRSP__КартинкаИнформация,
               |	ЭКОМ_ЦепочкаПокупателя.DESADV КАК ЭКОМ_Документ_DESADV,
               |	НЕ(ЭКОМ_ЦепочкаПокупателя.DESADV.Комментарий ЕСТЬ NULL
               |			ИЛИ (ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.DESADV.Комментарий КАК СТРОКА(10))) = """") КАК ЭКОМ_Документ_DESADV__КартинкаИнформация,
               |	НЕ(ЭКОМ_ЦепочкаПокупателя.ЮЗД.Комментарий ЕСТЬ NULL
               |			ИЛИ (ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.ЮЗД.Комментарий КАК СТРОКА(10))) = """") КАК ДокументЭКОМ_ЮЗД__КартинкаИнформация,
               |	ЭКОМ_ЦепочкаПокупателя.ВозвратнаяНакладная КАК ВозвратТоваровПоставщику,
               |	ЭКОМ_ЦепочкаПокупателя.Накладная КАК ДокументПоступления,
               |	ВЫБОР
               |		КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД_Основание = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА НЕОПРЕДЕЛЕНО
               |		КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.Накладная) = ТИПЗНАЧЕНИЯ(&Накладная_ПустаяСсылка)
               |			ТОГДА НЕОПРЕДЕЛЕНО
               |		ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Накладная
               |	КОНЕЦ КАК КорректировкаПоступления,
               |	ЭКОМ_ЦепочкаПокупателя.ДатаПоставки КАК ДатаПоставки,
               |	ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.КоличествоЗаказ КАК ЧИСЛО(15, 2)) КАК Заказано,
               |	ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.КоличествоНакладная КАК ЧИСЛО(15, 2)) КАК Принято,
               |	ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.КоличествоORDRSP КАК ЧИСЛО(15, 2)) КАК Подтверждено,
               |	ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.КоличествоDESADV КАК ЧИСЛО(15, 2)) КАК Отгружено,
               |	ЭКОМ_ЦепочкаПокупателя.Контрагент КАК Контрагент,
               |	ЭКОМ_ЦепочкаПокупателя.Организация КАК Организация,
               |	ЭКОМ_ЦепочкаПокупателя.ТочкаДоставки КАК ТочкаДоставки,
               |	ЭКОМ_ЦепочкаПокупателя.НомерИсправления КАК НомерИсправления,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_DESADV КАК Статус_DESADV,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_ORDER КАК Статус_ORDER,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_ORDRSP КАК Статус_ORDRSP,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_RECADV КАК Статус_RECADV,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_RETANN КАК Статус_RETANN,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_RETINS КАК Статус_RETINS,
               |	ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.СуммаЗаказ КАК ЧИСЛО(15, 2)) КАК СуммаЗаказ,
               |	ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.СуммаНакладная КАК ЧИСЛО(15, 2)) КАК СуммаНакладная,
               |	ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.СуммаСЧФ КАК ЧИСЛО(15, 2)) КАК СуммаСЧФ,
               |	ВЫРАЗИТЬ(ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего КАК ЧИСЛО(15, 2)) КАК СуммаЮЗД_XML,
               |	ЭКОМ_ЦепочкаПокупателя.ТекстОшибки КАК ТекстОшибки,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД КАК ДокументЭКОМ_ЮЗД,
               |	ЭКОМ_ЦепочкаПокупателя.СтатусЮЗД КАК Статус_УПД,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.СЧФ = &СЧФ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.СЧФ
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.Накладная = &Накладная_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.Накладная
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.DESADV = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.DESADV
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ORDRSP = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.ORDRSP
               |		ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Заказ
               |	КОНЕЦ КАК Ссылка,
               |	ЭКОМ_ЦепочкаПокупателя.СЧФ КАК ДокументСЧФ,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ТекстОшибки = """"
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК ЕстьОшибка,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД.СЧФНомер КАК СЧФ_Номер,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД.СЧФДата КАК СЧФ_Дата,
               |	ВЫБОР
               |		КОГДА ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего > 0
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего
               |		ИНАЧЕ -(ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего)
               |	КОНЕЦ КАК Дельта,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_STATUS КАК Статус_STATUS,
               |	ВЫБОР
               |		КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД.ВидДокумента В (ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Испр), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Испр))
               |			ТОГДА ИСТИНА
               |		КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД_Основание.ВидДокумента В (ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Испр), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Испр))
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК ЭтоМаркируемыйЮЗД,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД.ВидДокумента КАК ЮЗДВидДокумента,
               |	ЭКОМ_ЦепочкаПокупателя.ТекстОтклоненияАннулирования КАК ТекстОтклоненияАннулирования,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД.Комментарий КАК ТекстУточнения,
               |	ЭКОМ_ЦепочкаПокупателя.ТекстПричиныАннулирования КАК ТекстПричиныАннулирования,
               |	ВЫБОР
               |		КОГДА НЕ(ЭКОМ_ЦепочкаПокупателя.СЧФ = &СЧФ_ПустаяСсылка
               |					ИЛИ ЭКОМ_ЦепочкаПокупателя.СЧФ = НЕОПРЕДЕЛЕНО)
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.СЧФ
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ЮЗД = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД
               |		КОГДА НЕ(ЭКОМ_ЦепочкаПокупателя.Накладная = &Накладная_ПустаяСсылка
               |					ИЛИ ЭКОМ_ЦепочкаПокупателя.Накладная = НЕОПРЕДЕЛЕНО)
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.Накладная
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.DESADV = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.DESADV
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ORDRSP = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.ORDRSP
               |		ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Заказ
               |	КОНЕЦ В (&масПомеченныхДоков) КАК Пометка,
               |	ВЫБОР
               |		КОГДА НЕ(ЭКОМ_ЦепочкаПокупателя.СЧФ = &СЧФ_ПустаяСсылка
               |					ИЛИ ЭКОМ_ЦепочкаПокупателя.СЧФ = НЕОПРЕДЕЛЕНО)
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.СЧФ
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ЮЗД = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД
               |		КОГДА НЕ(ЭКОМ_ЦепочкаПокупателя.Накладная = &Накладная_ПустаяСсылка
               |					ИЛИ ЭКОМ_ЦепочкаПокупателя.Накладная = НЕОПРЕДЕЛЕНО)
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.Накладная
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.DESADV = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.DESADV
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ORDRSP = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.ORDRSP
               |		ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Заказ
               |	КОНЕЦ КАК ДокументыВсе
               |ИЗ
               |	РегистрСведений.ЭКОМ_ЦепочкиДокументовПокупателя КАК ЭКОМ_ЦепочкаПокупателя";

ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Накладная_ПустаяСсылка"    , ИмяПоступления1С);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ЭКОМ_Документ_ПустаяСсылка", ИмяЭКОМ_Документа);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СЧФ_ПустаяСсылка"          , ИмяСчетФактуры1С);