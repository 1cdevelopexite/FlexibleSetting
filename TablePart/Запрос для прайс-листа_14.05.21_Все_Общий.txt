ИмяУстановкаЦенНоменклатуры1С = "ЗНАЧЕНИЕ(Документ.УстановкаЦенНоменклатуры.ПустаяСсылка)";

ТекстЗапроса = "ВЫБРАТЬ
               |	УстановкаЦенНоменклатуры.Ссылка КАК УстановкаЦенНоменклатуры,
               |	ЭКОМ_ДокументыИсходящийPRICAT.Ссылка КАК PRICAT,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ВидДокумента КАК ВидДокумента,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ДействуетС КАК НачалоДействия,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ДействуетПо КАК КонецДействия,
               |	УстановкаЦенНоменклатуры.Дата КАК Дата,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ФайлДата КАК ДатаПрайсЛиста,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ФайлНомер КАК НомерПрайсЛиста,
               |	ЭКОМ_ДокументыИсходящийPRICAT.НомерДоговораНаПоставку КАК НомерДоговора,
               |	ЭКОМ_ДокументыИсходящийPRICAT.Организация КАК Организация,
               |	ЭКОМ_ДокументыИсходящийPRICAT.Контрагент КАК Контрагент,
               |	ЭКОМ_ДокументыИсходящийPRICAT.Валюта КАК Валюта,
               |	ВЫБОР
               |		КОГДА ЭКОМ_Объекты_События.Статус ЕСТЬ NULL
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.НеОбработан)
               |		КОГДА ЭКОМ_ДокументыВходящийPRICAT.УточнениеОПоставке = ""51""
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Подтвержден)
               |		КОГДА ЭКОМ_ДокументыВходящийPRICAT.УточнениеОПоставке = ""99""
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ОтклоненПолностью)
               |		КОГДА ЭКОМ_Объекты_События.Статус = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Отправлен)
               |			ТОГДА ЭКОМ_Объекты_События.Статус
               |		ИНАЧЕ ЭКОМ_ДокументыИсходящийPRICAT.СтатусОбработкиДокумента
               |	КОНЕЦ КАК СтатусОбработкиДокумента,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ДокументыИсходящийPRICAT.ТекстОшибки = """"
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК ЕстьОшибка,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ДокументыИсходящийPRICAT.Ссылка ЕСТЬ NULL
               |			ТОГДА ЭКОМ_ДокументыИсходящийPRICAT.Ссылка
               |		ИНАЧЕ УстановкаЦенНоменклатуры.Ссылка
               |	КОНЕЦ В (&масПомеченныхДоков) КАК Пометка,
               |	""Исх"" КАК ИмяТаблицы,
               |	ВЫБОР
               |		КОГДА ЭКОМ_ДокументыИсходящийPRICAT.УточнениеОПоставке = ""9""
               |			ТОГДА ""9 - прайс-лист""
               |		КОГДА ЭКОМ_ДокументыИсходящийPRICAT.УточнениеОПоставке = ""13""
               |			ТОГДА ""13 - запрос прайс-листа""
               |		КОГДА ЭКОМ_ДокументыИсходящийPRICAT.УточнениеОПоставке = ""51""
               |			ТОГДА ""51 - подтверждение прайс-листа""
               |		КОГДА ЭКОМ_ДокументыИсходящийPRICAT.УточнениеОПоставке = ""99""
               |			ТОГДА ""99 - отказ на прайс-лист""
               |		ИНАЧЕ """"
               |	КОНЕЦ КАК Тип,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ДокументыИсходящийPRICAT.Ссылка ЕСТЬ NULL
               |			ТОГДА ЭКОМ_ДокументыИсходящийPRICAT.Ссылка
               |		ИНАЧЕ УстановкаЦенНоменклатуры.Ссылка
               |	КОНЕЦ КАК ДокументыВсе
               |ИЗ
               |	Документ.УстановкаЦенНоменклатуры КАК УстановкаЦенНоменклатуры
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭКОМ_Документы КАК ЭКОМ_ДокументыИсходящийPRICAT
               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_Объекты_События КАК ЭКОМ_Объекты_События
               |			ПО ЭКОМ_ДокументыИсходящийPRICAT.Ссылка = ЭКОМ_Объекты_События.Документ_Основание
               |			ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭКОМ_Документы КАК ЭКОМ_ДокументыВходящийPRICAT
               |			ПО ЭКОМ_ДокументыИсходящийPRICAT.ФайлДата = ЭКОМ_ДокументыВходящийPRICAT.ФайлДата
               |				И ЭКОМ_ДокументыИсходящийPRICAT.ФайлНомер = ЭКОМ_ДокументыВходящийPRICAT.ФайлНомер
               |				И (ЭКОМ_ДокументыВходящийPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Входящий))
               |		ПО УстановкаЦенНоменклатуры.Ссылка = ЭКОМ_ДокументыИсходящийPRICAT.Документ1С
               |			И (ЭКОМ_ДокументыИсходящийPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий))
               |ГДЕ
               |	ВЫБОР
               |			КОГДА &НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Исходящий)
               |					ИЛИ &НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.ПустаяСсылка)
               |				ТОГДА ИСТИНА
               |			ИНАЧЕ ЛОЖЬ
               |		КОНЕЦ
               |	И УстановкаЦенНоменклатуры.Дата МЕЖДУ &ДатаНач И &ДатаКон
               |
               |ОБЪЕДИНИТЬ ВСЕ
               |
               |ВЫБРАТЬ
               |	ЭКОМ_ДокументыPRICAT.Документ1С,
               |	ЭКОМ_ДокументыPRICAT.Ссылка,
               |	ЭКОМ_ДокументыPRICAT.ВидДокумента,
               |	ЭКОМ_ДокументыPRICAT.ДействуетС,
               |	ЭКОМ_ДокументыPRICAT.ДействуетПо,
               |	ЭКОМ_ДокументыPRICAT.ФайлДата,
               |	ЭКОМ_ДокументыPRICAT.ФайлДата,
               |	ЭКОМ_ДокументыPRICAT.ФайлНомер,
               |	ЭКОМ_ДокументыPRICAT.НомерДоговораНаПоставку,
               |	ЭКОМ_ДокументыPRICAT.Организация,
               |	ЭКОМ_ДокументыPRICAT.Контрагент,
               |	ЭКОМ_ДокументыPRICAT.Валюта,
               |	ВЫБОР
               |		КОГДА ЭКОМ_Объекты_События.Статус ЕСТЬ NULL
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.НеОбработан)
               |		КОГДА ЭКОМ_ДокументыPRICAT.СтатусОбработкиДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Обработан)
               |				И ЭКОМ_Объекты_События.НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Входящий)
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Загружен)
               |		КОГДА ЭКОМ_Объекты_События.Статус = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Отправлен)
               |			ТОГДА ЭКОМ_Объекты_События.Статус
               |		КОГДА ЭКОМ_ДокументыОтветный.УточнениеОПоставке = ""51""
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Подтвержден)
               |		КОГДА ЭКОМ_ДокументыОтветный.УточнениеОПоставке = ""99""
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ОтклоненПолностью)
               |		ИНАЧЕ ЭКОМ_ДокументыPRICAT.СтатусОбработкиДокумента
               |	КОНЕЦ,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ДокументыPRICAT.ТекстОшибки = """"
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ДокументыPRICAT.Документ1С = НЕОПРЕДЕЛЕНО
               |				И НЕ ЭКОМ_ДокументыPRICAT.Документ1С ЕСТЬ NULL
               |				И НЕ ЭКОМ_ДокументыPRICAT.Документ1С = &УстановкаЦенНоменклатурыПустаяСсылка
               |			ТОГДА ЭКОМ_ДокументыPRICAT.Документ1С
               |		ИНАЧЕ ЭКОМ_ДокументыPRICAT.Ссылка
               |	КОНЕЦ В (&масПомеченныхДоков),
               |	""ВхИсх"",
               |	ВЫБОР
               |		КОГДА ЭКОМ_ДокументыPRICAT.УточнениеОПоставке = ""9""
               |			ТОГДА ""9 - прайс-лист""
               |		КОГДА ЭКОМ_ДокументыPRICAT.УточнениеОПоставке = ""13""
               |			ТОГДА ""13 - запрос прайс-листа""
               |		КОГДА ЭКОМ_ДокументыPRICAT.УточнениеОПоставке = ""51""
               |			ТОГДА ""51 - подтверждение прайс-листа""
               |		КОГДА ЭКОМ_ДокументыPRICAT.УточнениеОПоставке = ""99""
               |			ТОГДА ""99 - отказ на прайс-лист""
               |		ИНАЧЕ """"
               |	КОНЕЦ,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ДокументыPRICAT.Документ1С = НЕОПРЕДЕЛЕНО
               |				И НЕ ЭКОМ_ДокументыPRICAT.Документ1С ЕСТЬ NULL
               |				И НЕ ЭКОМ_ДокументыPRICAT.Документ1С = &УстановкаЦенНоменклатурыПустаяСсылка
               |			ТОГДА ЭКОМ_ДокументыPRICAT.Документ1С
               |		ИНАЧЕ ЭКОМ_ДокументыPRICAT.Ссылка
               |	КОНЕЦ
               |ИЗ
               |	Документ.ЭКОМ_Документы КАК ЭКОМ_ДокументыPRICAT
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_Объекты_События КАК ЭКОМ_Объекты_События
               |		ПО ЭКОМ_ДокументыPRICAT.Ссылка = ЭКОМ_Объекты_События.Документ_Основание
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭКОМ_Документы КАК ЭКОМ_ДокументыОтветный
               |		ПО ЭКОМ_ДокументыPRICAT.ФайлДата = ЭКОМ_ДокументыОтветный.ФайлДата
               |			И ЭКОМ_ДокументыPRICAT.ФайлНомер = ЭКОМ_ДокументыОтветный.ФайлНомер
               |			И (ЭКОМ_ДокументыОтветный.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий))
               |ГДЕ
               |	ВЫБОР
               |			КОГДА &НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.ПустаяСсылка)
               |				ТОГДА ЭКОМ_ДокументыPRICAT.ВидДокумента В (ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Входящий))
               |			КОГДА &НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Исходящий)
               |				ТОГДА ЭКОМ_ДокументыPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий)
               |			ИНАЧЕ ЭКОМ_ДокументыPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Входящий)
               |		КОНЕЦ
               |	И ВЫБОР
               |			КОГДА ЭКОМ_ДокументыPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий)
               |					И (ЭКОМ_ДокументыPRICAT.Документ1С = НЕОПРЕДЕЛЕНО
               |						ИЛИ ЭКОМ_ДокументыPRICAT.Документ1С ЕСТЬ NULL
               |						ИЛИ ЭКОМ_ДокументыPRICAT.Документ1С = """"
               |						ИЛИ ЭКОМ_ДокументыPRICAT.Документ1С = &УстановкаЦенНоменклатурыПустаяСсылка)
               |				ТОГДА ИСТИНА
               |			КОГДА ЭКОМ_ДокументыPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Входящий)
               |				ТОГДА ИСТИНА
               |			ИНАЧЕ ЛОЖЬ
               |		КОНЕЦ
               |	И ЭКОМ_ДокументыPRICAT.ФайлДата МЕЖДУ &ДатаНач И &ДатаКон";

ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УстановкаЦенНоменклатурыПустаяСсылка", ИмяУстановкаЦенНоменклатуры1С);
