ИмяУстановкаЦенНоменклатуры1С = "ЗНАЧЕНИЕ(Документ.УстановкаЦенНоменклатуры.ПустаяСсылка)";

ТекстЗапроса = "ВЫБРАТЬ
               |	УстановкаЦенНоменклатуры.Ссылка КАК УстановкаЦенНоменклатуры,
               |	ЭКОМ_ДокументыИсходящийPRICAT.Ссылка КАК PRICAT,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ВидДокумента КАК ВидДокумента,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ДействуетС КАК НачалоДействия,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ДействуетПо КАК КонецДействия,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ФайлДата КАК Дата,
               |	ЭКОМ_ДокументыИсходящийPRICAT.ФайлНомер КАК Номер,
               |	ЭКОМ_ДокументыИсходящийPRICAT.НомерДоговораНаПоставку КАК НомерДоговора,
               |	ЭКОМ_ДокументыИсходящийPRICAT.Организация КАК Организация,
               |	ЭКОМ_ДокументыИсходящийPRICAT.Контрагент КАК Контрагент,
               |	ЭКОМ_ДокументыИсходящийPRICAT.Валюта КАК Валюта,
               |	ВЫБОР
               |		КОГДА ЭКОМ_Объекты_События.Статус ЕСТЬ NULL
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ПустаяСсылка)
               |		КОГДА ЭКОМ_Объекты_События.Статус = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Отправлен)
               |			ТОГДА ЭКОМ_Объекты_События.Статус
               |		ИНАЧЕ ЭКОМ_ДокументыИсходящийPRICAT.СтатусОбработкиДокумента
               |	КОНЕЦ КАК СтатусОбработкиДокумента,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ДокументыИсходящийPRICAT.ТекстОшибки = """"
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК ЕстьОшибка,
               |	ЛОЖЬ КАК Пометка,
               |	""Исх"" КАК ЗапросТаблицы
               |ИЗ
               |	Документ.УстановкаЦенНоменклатуры КАК УстановкаЦенНоменклатуры
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭКОМ_Документы КАК ЭКОМ_ДокументыИсходящийPRICAT
               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_Объекты_События КАК ЭКОМ_Объекты_События
               |			ПО ЭКОМ_ДокументыИсходящийPRICAT.Ссылка = ЭКОМ_Объекты_События.Документ_Основание
               |		ПО УстановкаЦенНоменклатуры.Ссылка = ЭКОМ_ДокументыИсходящийPRICAT.Документ1С
               |			И (ЭКОМ_ДокументыИсходящийPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий))
               |ГДЕ
               |	ВЫБОР
               |			КОГДА &НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Исходящий)
               |					ИЛИ &НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.ПустаяСсылка)
               |				ТОГДА ИСТИНА
               |			ИНАЧЕ ЛОЖЬ
               |		КОНЕЦ
               |
               |ОБЪЕДИНИТЬ ВСЕ
               |
               |ВЫБРАТЬ
               |	ЭКОМ_ДокументыPRICAT.Документ1С,
               |	ЭКОМ_ДокументыPRICAT.Ссылка,
               |	ЭКОМ_ДокументыPRICAT.ВидДокумента,
               |	ЭКОМ_ДокументыPRICAT.ДействуетС,
               |	ЭКОМ_ДокументыPRICAT.ДействуетПо,
               |	ЭКОМ_ДокументыPRICAT.ФайлДата,
               |	ЭКОМ_ДокументыPRICAT.ФайлНомер,
               |	ЭКОМ_ДокументыPRICAT.НомерДоговораНаПоставку,
               |	ЭКОМ_ДокументыPRICAT.Организация,
               |	ЭКОМ_ДокументыPRICAT.Контрагент,
               |	ЭКОМ_ДокументыPRICAT.Валюта,
               |	ВЫБОР
               |		КОГДА ЭКОМ_Объекты_События.Статус ЕСТЬ NULL
               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ПустаяСсылка)
               |		КОГДА ЭКОМ_Объекты_События.Статус = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Отправлен)
               |			ТОГДА ЭКОМ_Объекты_События.Статус
               |		ИНАЧЕ ЭКОМ_ДокументыPRICAT.СтатусОбработкиДокумента
               |	КОНЕЦ,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ДокументыPRICAT.ТекстОшибки = """"
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ,
               |	ЛОЖЬ,
               |	""ВхИсх""
               |ИЗ
               |	Документ.ЭКОМ_Документы КАК ЭКОМ_ДокументыPRICAT
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_Объекты_События КАК ЭКОМ_Объекты_События
               |		ПО ЭКОМ_ДокументыPRICAT.Ссылка = ЭКОМ_Объекты_События.Документ_Основание
               |ГДЕ
               |	ВЫБОР
               |			КОГДА &НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.ПустаяСсылка)
               |				ТОГДА ЭКОМ_ДокументыPRICAT.ВидДокумента В (ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Входящий))
               |			КОГДА &НаправлениеОбмена = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Исходящий)
               |				ТОГДА ЭКОМ_ДокументыPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий)
               |			ИНАЧЕ ЭКОМ_ДокументыPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Входящий)
               |		КОНЕЦ
               |	И ВЫБОР
               |			КОГДА ЭКОМ_ДокументыPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Исходящий)
               |					И (ЭКОМ_ДокументыPRICAT.Документ1С = НЕОПРЕДЕЛЕНО
               |						ИЛИ ЭКОМ_ДокументыPRICAT.Документ1С ЕСТЬ NULL
               |						ИЛИ ЭКОМ_ДокументыPRICAT.Документ1С = """"
               |						ИЛИ ЭКОМ_ДокументыPRICAT.Документ1С = &УстановкаЦенНоменклатурыПустаяСсылка)
               |				ТОГДА ИСТИНА
               |			КОГДА ЭКОМ_ДокументыPRICAT.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.PRICAT_Входящий)
               |				ТОГДА ИСТИНА
               |			ИНАЧЕ ЛОЖЬ
               |		КОНЕЦ";

ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УстановкаЦенНоменклатурыПустаяСсылка", ИмяУстановкаЦенНоменклатуры1С);
