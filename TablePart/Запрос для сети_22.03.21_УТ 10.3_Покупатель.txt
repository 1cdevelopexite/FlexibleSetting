ТекстЗапроса = "ВЫБРАТЬ
               |    ВЫБОР
               |         КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.СЧФ) = ТИП(Документ.СчетФактураПолученный)
               |                   И НЕ ЭКОМ_ЦепочкаПокупателя.СЧФ = ЗНАЧЕНИЕ(Документ.СчетФактураПолученный.ПустаяСсылка)
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.СЧФ
               |         КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.Накладная) = ТИП(Документ.ПоступлениеТоваровУслуг)
               |                   И НЕ ЭКОМ_ЦепочкаПокупателя.Накладная = ЗНАЧЕНИЕ(Документ.ПоступлениеТоваровУслуг.ПустаяСсылка)
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.Накладная
               |         КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.DESADV) = ТИП(Документ.ЭКОМ_Документы)
               |                   И НЕ ЭКОМ_ЦепочкаПокупателя.DESADV = ЗНАЧЕНИЕ(Документ.ЭКОМ_Документы.ПустаяСсылка)
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.DESADV
               |         КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.ORDRSP) = ТИП(Документ.ЭКОМ_Документы)
               |                   И НЕ ЭКОМ_ЦепочкаПокупателя.ORDRSP = ЗНАЧЕНИЕ(Документ.ЭКОМ_Документы.ПустаяСсылка)
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.ORDRSP
               |         ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Заказ
               |    КОНЕЦ КАК ДокументыВсе,
               |    ЭКОМ_ЦепочкаПокупателя.ORDERDATE КАК ДатаЗаказа,
               |    ЭКОМ_ЦепочкаПокупателя.ORDERNUMBER КАК НомерЗаказа,
               |    ЭКОМ_ЦепочкаПокупателя.Заказ КАК ДокументЗаказа,
               |    ЭКОМ_ЦепочкаПокупателя.ORDRSP КАК ЭКОМ_Документ_ORDRSP,
               |    ЭКОМ_ЦепочкаПокупателя.DESADV КАК ЭКОМ_Документ_DESADV,
               |    ЭКОМ_ЦепочкаПокупателя.ВозвратнаяНакладная КАК ВозвратТоваровПоставщику,
               |    ЭКОМ_ЦепочкаПокупателя.Накладная КАК ДокументПоступления,
               |    ВЫБОР
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД_Основание = ЗНАЧЕНИЕ(Документ.ЭКОМ_Документы.ПустаяСсылка)
               |              ТОГДА НЕОПРЕДЕЛЕНО
               |         ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Накладная
               |    КОНЕЦ КАК КорректировкаПоступления,
               |    ЭКОМ_ЦепочкаПокупателя.ДатаПоставки КАК ДатаПоставки,
               |    ЭКОМ_ЦепочкаПокупателя.КоличествоЗаказ КАК Заказано,
               |    ЭКОМ_ЦепочкаПокупателя.КоличествоНакладная КАК Принято,
               |    ЭКОМ_ЦепочкаПокупателя.КоличествоDESADV КАК Отгружено,
               |    ЭКОМ_ЦепочкаПокупателя.Контрагент КАК Контрагент,
               |    ЭКОМ_ЦепочкаПокупателя.Организация КАК Организация,
               |    ЭКОМ_ЦепочкаПокупателя.ТочкаДоставки КАК ТочкаДоставки,
               |    ЭКОМ_ЦепочкаПокупателя.НомерИсправления КАК НомерИсправления,
               |    ЭКОМ_ЦепочкаПокупателя.Статус_DESADV КАК Статус_DESADV,
               |    ЭКОМ_ЦепочкаПокупателя.Статус_ORDER КАК Статус_ORDER,
               |    ЭКОМ_ЦепочкаПокупателя.Статус_ORDRSP КАК Статус_ORDRSP,
               |    ЭКОМ_ЦепочкаПокупателя.Статус_RECADV КАК Статус_RECADV,
               |    ЭКОМ_ЦепочкаПокупателя.СуммаЗаказ КАК СуммаЗаказ,
               |    ЭКОМ_ЦепочкаПокупателя.СуммаНакладная КАК СуммаНакладная,
               |    ЭКОМ_ЦепочкаПокупателя.СуммаСЧФ КАК СуммаСЧФ,
               |    ЭКОМ_ЦепочкаПокупателя.ТекстОшибки КАК ТекстОшибки,
               |    ЭКОМ_ЦепочкаПокупателя.ЮЗД КАК ДокументЭКОМ_ЮЗД,
               |    ВЫБОР
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.Статус_DP_UVUTOCH_14
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ОтклоненоАннулирование)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_13
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ПринятоАннулирование)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.СтатусНаправление_DP_PRANNUL_12 = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Входящий)
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ПредложеноАннулирование)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.СтатусНаправление_DP_PRANNUL_12 = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Исходящий)
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ОтправленоАннулирование)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД.Проведен = ЛОЖЬ
               |                   ИЛИ ЕСТЬNULL(ЭКОМ_ЦепочкаПокупателя.СЧФ, ЗНАЧЕНИЕ(Документ.СчетФактураПолученный.Пустаяссылка)) = ЗНАЧЕНИЕ(Документ.СчетФактураПолученный.Пустаяссылка)
               |                   ИЛИ ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.СЧФ) ЕСТЬ NULL
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.НеОбработан)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД.ТипДокумента = ""ДОП""
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_Подпись_11
               |                   И ЭКОМ_ЦепочкаПокупателя.ЮЗД.Проведен
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ДокументооборотЗавершен)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД.ТипДокумента = ""СЧФ""
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_PDOTPR_03
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_05
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_06
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_PDOTPR_07
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_08
               |                   И ЭКОМ_ЦепочкаПокупателя.ЮЗД.Проведен
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ДокументооборотЗавершен)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.Статус_DP_PDOTPR_03
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_05
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_06
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_PDOTPR_07
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_08
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_Подпись_11
               |                   И ЭКОМ_ЦепочкаПокупателя.ЮЗД.Проведен
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ДокументооборотЗавершен)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.Статус_DP_UVUTOCH_09
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ОтправленоУточнение)
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.Статус_DP_PDOTPR_03
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_05
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_06
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_PDOTPR_07
               |                   И ЭКОМ_ЦепочкаПокупателя.Статус_DP_IZVPOL_08
               |              ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ТребуетсяПодписатьУПД)
               |         ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Загружен)
               |    КОНЕЦ КАК Статус_УПД,
               |    ВЫБОР
               |         КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.СЧФ) = ТИП(Документ.СчетФактураПолученный)
               |                   И НЕ ЭКОМ_ЦепочкаПокупателя.СЧФ = ЗНАЧЕНИЕ(Документ.СчетФактураПолученный.ПустаяСсылка)
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.СЧФ
               |         КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.Накладная) = ТИП(Документ.ПоступлениеТоваровУслуг)
               |                   И НЕ ЭКОМ_ЦепочкаПокупателя.Накладная = ЗНАЧЕНИЕ(Документ.ПоступлениеТоваровУслуг.ПустаяСсылка)
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.Накладная
               |         КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.DESADV) = ТИП(Документ.ЭКОМ_Документы)
               |                   И НЕ ЭКОМ_ЦепочкаПокупателя.DESADV = ЗНАЧЕНИЕ(Документ.ЭКОМ_Документы.ПустаяСсылка)
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.DESADV
               |         КОГДА ТИПЗНАЧЕНИЯ(ЭКОМ_ЦепочкаПокупателя.ORDRSP) = ТИП(Документ.ЭКОМ_Документы)
               |                   И НЕ ЭКОМ_ЦепочкаПокупателя.ORDRSP = ЗНАЧЕНИЕ(Документ.ЭКОМ_Документы.ПустаяСсылка)
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.ORDRSP
               |         ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Заказ
               |    КОНЕЦ КАК Ссылка,
               |    ЭКОМ_ЦепочкаПокупателя.СЧФ КАК ДокументСЧФ,
               |    ВЫБОР
               |         КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ТекстОшибки = """"
               |              ТОГДА ИСТИНА
               |         ИНАЧЕ ЛОЖЬ
               |    КОНЕЦ КАК ЕстьОшибка,
               |    ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего КАК СуммаЮЗД_XML,
               |    ЭКОМ_ЦепочкаПокупателя.ЮЗД.СЧФНомер КАК СЧФ_Номер,
               |    ЭКОМ_ЦепочкаПокупателя.ЮЗД.СЧФДата КАК СЧФ_Дата,
               |    ВЫБОР
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего > 0
               |              ТОГДА ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего
               |         ИНАЧЕ -(ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего)
               |    КОНЕЦ КАК Дельта,
               |    ЭКОМ_ЦепочкаПокупателя.Статус_STATUS КАК Статус_STATUS,
               |    ВЫБОР
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД.ВидДокумента В (ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Испр), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Испр))
               |              ТОГДА ИСТИНА
               |         КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД_Основание.ВидДокумента В (ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Испр), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Испр))
               |              ТОГДА ИСТИНА
               |         ИНАЧЕ ЛОЖЬ
               |    КОНЕЦ КАК ЭтоМаркируемыйЮЗД,
               |    ЭКОМ_ЦепочкаПокупателя.ЮЗД.ВидДокумента КАК ЮЗДВидДокумента,
               |    ЭКОМ_ЦепочкаПокупателя.ЮЗД.ИнформацияПоДокументу КАК СтатусДокументооборота,
               |    ЭКОМ_ЦепочкаПокупателя.ТекстОтклоненияАннулирования КАК ТекстОтклоненияАннулирования,
               |    ЭКОМ_ЦепочкаПокупателя.ТекстПричиныАннулирования КАК ТекстПричиныАннулирования
               |ИЗ
               |    РегистрСведений.ЭКОМ_ЦепочкиДокументовПокупателя КАК ЭКОМ_ЦепочкаПокупателя
               |ГДЕ
               |    ЭКОМ_ЦепочкаПокупателя.ORDERDATE МЕЖДУ &ДатаНач И &ДатаКон";