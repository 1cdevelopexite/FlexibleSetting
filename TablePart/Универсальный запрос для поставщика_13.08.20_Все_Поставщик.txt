// УТ 10.3, для других конфигураций необходимо указать свои настройки
ИмяЗаказа1С         = "Значение(Документ.ЗаказПокупателя.ПустаяСсылка)";
ИмяРеализации1С     = "Значение(Документ.РеализацияТоваровУслуг.ПустаяСсылка)";
ИмяЭКОМ_Документа   = "Значение(Документ.ЭКОМ_Документы.ПустаяСсылка)";
ИмяСчетФактуры1С    = "Значение(Документ.СчетФактураВыданный.ПустаяСсылка)";
ИмяКоррРеализации1С = "Значение(Документ.КорректировкаРеализации.ПустаяСсылка)";

ТекстЗапроса = 
"ВЫБРАТЬ
|	ЭКОМ_ЦепочкиДокументовПоставщика.ORDERNUMBER КАК НомерЗаказа,
|	ЭКОМ_ЦепочкиДокументовПоставщика.ORDERDATE КАК ДатаЗаказа,
|	ЭКОМ_ЦепочкиДокументовПоставщика.ORDER КАК ЭКОМ_Документ_ORDER,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Заказ КАК ДокументЗаказа,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Накладная КАК ДокументРеализации,
|	ЭКОМ_ЦепочкиДокументовПоставщика.RECADV КАК ЭКОМ_Документ_RECADV,
|	ЭКОМ_ЦепочкиДокументовПоставщика.RETANN КАК ЭКОМ_Документ_RETANN,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор КАК КорректировкаРеализации,
|	ВЫБОР
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор = &СЧФ_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ
|		ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|	КОНЕЦ КАК ДокументСЧФ,
|	ЭКОМ_ЦепочкиДокументовПоставщика.ВозвратнаяНакладная КАК ВозвратТоваровОтПокупателя,
|	ЭКОМ_ЦепочкиДокументовПоставщика.ДатаПоставки КАК ДатаПоставки,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Организация КАК Организация,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Контрагент КАК Контрагент,
|	ЭКОМ_ЦепочкиДокументовПоставщика.ТочкаДоставки КАК ТочкаДоставки,
|	ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ КАК СЧФ,
|	ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор КАК СЧФ_Кор,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ORDER КАК Статус_ORDER,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ORDRSP КАК Статус_ORDRSP,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DESADV КАК Статус_DESADV,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DESSCC КАК Статус_DESSCC,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RECADV КАК Статус_RECADV,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RETANN КАК Статус_RETANN,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_INVOICE КАК Статус_INVOICE,
|	ВЫБОР
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_UVUTOCH_14
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ОтклоненоАннулирование)
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_13
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ПринятоАннулирование)
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СтатусНаправление_DP_PRANNUL_12 = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Входящий)
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ПредложеноАннулирование)
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СтатусНаправление_DP_PRANNUL_12 = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Исходящий)
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ОтправленоАннулирование)
|		КОГДА ((ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_KORSCHFDOPPOK_11
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPOK_11
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPOKMARK_11
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPOKPROS_11)
|               И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_06 = ИСТИНА)
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_REZRUZAK
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ДокументооборотЗавершен)
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_KORSCHFDOPPOK_11
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPOK_11
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPOKMARK_11
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPOKPROS_11
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ПодписаноПокупателем)
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_UVUTOCH_09
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_10
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Уточнение)
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_06
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_04
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_PDPOL_02
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ОжиданиеПодтверждения)
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_KORSCHFDOPPR_01
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPR_01
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPRMARK_01
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPRPROS_01
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPR_01_Испр
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPRMARK_01_Испр
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPRPROS_01_Испр
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_KORSCHFDOPPR_01_Испр
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_REZRUISP
|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Отправлен)
|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.НеОбработан)
|	КОНЕЦ КАК Статус_УПД,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_Палеты КАК Палеты,
|	ЭКОМ_ЦепочкиДокументовПоставщика.НомерИсправления КАК НомерИсправления,
|	ЭКОМ_ЦепочкиДокументовПоставщика.ТекстОшибки КАК ТекстОшибки,
|	ВЫБОР
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор = &СЧФ_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор = &Накладная_Кор_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = &СЧФ_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.RECADV = &RECADV_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.RECADV
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Накладная = &Накладная_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Накладная
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Заказ = &Заказ_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Заказ
|		ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.ORDER
|	КОНЕЦ КАК Ссылка,
|	ВЫБОР
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.СуммаСЧФ_Кор = 0
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СуммаСЧФ_Кор
|		ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.СуммаСЧФ
|	КОНЕЦ КАК СуммаСЧФ,
|	ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоORDER КАК Заказано,
|	ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоЗаказ КАК Подтверждено,
|	ВЫБОР
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоНакладная_Кор = 0
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоНакладная_Кор
|		ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоНакладная
|	КОНЕЦ КАК Отгружено,
|	ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоRECADV КАК Принято,
|	ВЫБОР
|		КОГДА (ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPOK_11
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_KORSCHFDOPPOK_11)
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_PDPOL_02
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_04
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_06
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_06
|				И (ЭКОМ_ЦепочкиДокументовПоставщика.СтатусНаправление_DP_PRANNUL_12 = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Исходящий)
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.СтатусНаправление_DP_PRANNUL_12 = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_НаправлениеОбмена.Входящий))
|			ТОГДА ""Аннулирование""
|		КОГДА (ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPOK_11
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_KORSCHFDOPPOK_11)
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_PDPOL_02
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_04
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_IZVPOL_06
|			ТОГДА ""Документооборот завершен""
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DP_UVUTOCH_09
|			ТОГДА ""Пришло уточнение от покупателя. Необходимо внести исправления.""
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPR_01
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_NSCHFDOPPR_01_Испр
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_KORSCHFDOPPR_01
|				ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ON_KORSCHFDOPPR_01_Испр
|			ТОГДА ""Ожидайте квитанции ЮЗД""
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RECADV
|				И НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ ЕСТЬ NULL
|						ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = НЕОПРЕДЕЛЕНО)
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийИсправленияПоступленияРеализации.СогласованноеИзменение)
|			ТОГДА ""Отправьте УКД""
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RECADV
|				И НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ ЕСТЬ NULL
|						ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = НЕОПРЕДЕЛЕНО)
|			ТОГДА ""Отправьте УПД""
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RECADV
|				И (ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ ЕСТЬ NULL
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = НЕОПРЕДЕЛЕНО)
|			ТОГДА ""Создайте Счет-фактуру""
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DESADV
|				И НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RECADV
|			ТОГДА ""Ожидайте RECADV""
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Накладная ЕСТЬ NULL
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ORDRSP
|				И НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DESADV
|			ТОГДА ""Отправьте DESADV""
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ORDRSP
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Накладная ЕСТЬ NULL
|			ТОГДА ""Создайте Реализацию товаров и услуг""
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Заказ ЕСТЬ NULL
|				И НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ORDRSP
|			ТОГДА ""Отправьте ORDRSP""
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ORDER
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Заказ ЕСТЬ NULL
|			ТОГДА ""Создайте Заказ покупателя""
|		ИНАЧЕ ""-""
|	КОНЕЦ КАК Статус,
|	ВЫБОР
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.ТекстОшибки = """"
|			ТОГДА ИСТИНА
|		ИНАЧЕ ЛОЖЬ
|	КОНЕЦ КАК ЕстьОшибка,
|	ВЫБОР
|		КОГДА ЕСТЬNULL(ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоНакладная, 0) <> ЕСТЬNULL(ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоRECADV, 0)
|				И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RECADV
|			ТОГДА ИСТИНА
|		ИНАЧЕ ЛОЖЬ
|	КОНЕЦ КАК ЕстьРасхождение,
|	ВЫБОР
|		КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор.ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|	КОНЕЦ КАК СчетФактураКорректировочная,
|	ВЫБОР
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор.ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|	КОНЕЦ КАК СчетФактураИсправительная,
|	ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ КАК СчетФактураИсходная,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_Транспорт КАК Транспорт,
|	ЭКОМ_ЦепочкиДокументовПоставщика.Статус_STATUS,
|	ЭКОМ_ЦепочкиДокументовПоставщика.ТекстОтклоненияАннулирования,
|	ЭКОМ_ЦепочкиДокументовПоставщика.ТекстПричиныАннулирования,
|	ЭКОМ_Объекты_СобытияУточнение.ТекстОшибки КАК ТекстУточнения
|ИЗ
|	РегистрСведений.ЭКОМ_ЦепочкиДокументовПоставщика КАК ЭКОМ_ЦепочкиДокументовПоставщика
|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_Объекты_События КАК ЭКОМ_Объекты_СобытияУточнение
|		ПО ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = ЭКОМ_Объекты_СобытияУточнение.Документ_Основание
|			И (ЭКОМ_Объекты_СобытияУточнение.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.DP_UVUTOCH_09))
|ГДЕ
|	ЭКОМ_ЦепочкиДокументовПоставщика.ORDERDATE МЕЖДУ &ДатаНач И &ДатаКон";

ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Заказ_ПустаяСсылка"        , ИмяЗаказа1С);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Накладная_ПустаяСсылка"    , ИмяРеализации1С);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&RECADV_ПустаяСсылка"       , ИмяЭКОМ_Документа);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СЧФ_ПустаяСсылка"          , ИмяСчетФактуры1С);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Накладная_Кор_ПустаяСсылка", ИмяКоррРеализации1С);

