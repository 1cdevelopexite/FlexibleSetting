ТекстЗапроса =
"ВЫБРАТЬ
|	ВЫБОР
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор = &СЧФ_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор = &Накладная_Кор_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = &СЧФ_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.RECADV = &RECADV_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.RECADV
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.Накладная = &Накладная_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Накладная = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Накладная
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.Заказ = &Заказ_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Заказ = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Заказ
|		ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.ORDER
|	КОНЕЦ В (&масПомеченныхДоков) КАК Пометка,
|	ВЫБОР
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор = &СЧФ_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор = &Накладная_Кор_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = &СЧФ_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ
|		КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.RECADV = &RECADV_ПустаяСсылка
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.RECADV
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.Накладная = &Накладная_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Накладная = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Накладная
|		КОГДА НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.Заказ = &Заказ_ПустаяСсылка
|					ИЛИ ЭКОМ_ЦепочкиДокументовПоставщика.Заказ = НЕОПРЕДЕЛЕНО)
|			ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.Заказ
|		ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.ORDER
|	КОНЕЦ КАК ДокументыВсе,
|    ЭКОМ_ЦепочкиДокументовПоставщика.ORDERNUMBER КАК НомерЗаказа,
|    ЭКОМ_ЦепочкиДокументовПоставщика.ORDERDATE КАК ДатаЗаказа,
|    ЭКОМ_ЦепочкиДокументовПоставщика.ORDER КАК ЭКОМ_Документ_ORDER,
|    НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.ORDER.Комментарий ЕСТЬ NULL
|    	ИЛИ (ВЫРАЗИТЬ(ЭКОМ_ЦепочкиДокументовПоставщика.ORDER.Комментарий КАК СТРОКА(10))) = """") КАК ЭКОМ_Документ_ORDER__КартинкаИнформация,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Заказ КАК ДокументЗаказа,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Накладная КАК ДокументРеализации,
|    ЭКОМ_ЦепочкиДокументовПоставщика.RECADV КАК ЭКОМ_Документ_RECADV,
|    НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.RECADV.Комментарий ЕСТЬ NULL
|       ИЛИ (ВЫРАЗИТЬ(ЭКОМ_ЦепочкиДокументовПоставщика.RECADV.Комментарий КАК СТРОКА(10))) = """") КАК ЭКОМ_Документ_RECADV__КартинкаИнформация,
|    ЭКОМ_ЦепочкиДокументовПоставщика.RETANN КАК ЭКОМ_Документ_RETANN,
|    НЕ(ЭКОМ_ЦепочкиДокументовПоставщика.RETANN.Комментарий ЕСТЬ NULL
|       ИЛИ (ВЫРАЗИТЬ(ЭКОМ_ЦепочкиДокументовПоставщика.RETANN.Комментарий КАК СТРОКА(10))) = """") КАК ЭКОМ_Документ_RETANN__КартинкаИнформация,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Накладная_Кор КАК КорректировкаРеализации,
|    ВЫБОР
|        КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор = &СЧФ_ПустаяСсылка
|            ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ
|        ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|    КОНЕЦ КАК ДокументСЧФ,
|    ЭКОМ_ЦепочкиДокументовПоставщика.НомерИсправления КАК НомерИсправления,
|    ЭКОМ_ЦепочкиДокументовПоставщика.ВозвратнаяНакладная КАК ВозвратТоваровОтПокупателя,
|    ЭКОМ_ЦепочкиДокументовПоставщика.ДатаПоставки КАК ДатаПоставки,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Организация КАК Организация,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Контрагент КАК Контрагент,
|    ЭКОМ_ЦепочкиДокументовПоставщика.ТочкаДоставки КАК ТочкаДоставки,
|    ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ КАК СЧФ,
|    ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор КАК СЧФ_Кор,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ORDER КАК Статус_ORDER,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Статус_ORDRSP КАК Статус_ORDRSP,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DESADV КАК Статус_DESADV,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Статус_DESSCC КАК Статус_DESSCC,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RECADV КАК Статус_RECADV,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RETANN КАК Статус_RETANN,
|    ЭКОМ_ЦепочкиДокументовПоставщика.Статус_INVOICE КАК Статус_INVOICE,
|    ЭКОМ_ЦепочкиДокументовПоставщика.СтатусЮЗД КАК Статус_УПД,
|    ВЫБОР
|        КОГДА Палеты.Документ ЕСТЬ NULL
|            ТОГДА ЛОЖЬ
|        ИНАЧЕ ИСТИНА
|    КОНЕЦ КАК Палеты,
|    ЭКОМ_ЦепочкиДокументовПоставщика.ТекстОшибки КАК ТекстОшибки,
|    ВЫРАЗИТЬ (ВЫБОР
|        КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.СуммаСЧФ_Кор = 0
|            ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СуммаСЧФ_Кор
|        ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.СуммаСЧФ
|    КОНЕЦ КАК ЧИСЛО(15, 2)) КАК СуммаСЧФ,
|    ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоORDER КАК Заказано,
|    ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоЗаказ КАК Подтверждено,
|    ВЫБОР
|        КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоНакладная_Кор = 0
|            ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоНакладная_Кор
|        ИНАЧЕ ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоНакладная
|    КОНЕЦ КАК Отгружено,
|    ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоRECADV КАК Принято,
|    ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.ПустаяСсылка) КАК Статус,
|    ВЫБОР
|        КОГДА НЕ ЭКОМ_ЦепочкиДокументовПоставщика.ТекстОшибки = """"
|            ТОГДА ИСТИНА
|        ИНАЧЕ ЛОЖЬ
|    КОНЕЦ КАК ЕстьОшибка,
|    ВЫБОР
|        КОГДА ЕСТЬNULL(ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоНакладная, 0) <> ЕСТЬNULL(ЭКОМ_ЦепочкиДокументовПоставщика.КоличествоRECADV, 0)
|                И ЭКОМ_ЦепочкиДокументовПоставщика.Статус_RECADV
|            ТОГДА ИСТИНА
|        ИНАЧЕ ЛОЖЬ
|    КОНЕЦ КАК ЕстьРасхождение,
|    ВЫБОР
|        КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор.Корректировочный
|            ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|    КОНЕЦ КАК СчетФактураКорректировочная,
|    ВЫБОР
|        КОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор.Исправление
|            ТОГДА ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ_Кор
|    КОНЕЦ КАК СчетФактураИсправительная,
|    ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ КАК СчетФактураИсходная,
|	 ЭКОМ_ЦепочкиДокументовПоставщика.Статус_Транспорт КАК Транспорт,
|    ЭКОМ_Объекты_СобытияУточнение.ТекстОшибки КАК ТекстУточнения
|ИЗ
|    РегистрСведений.ЭКОМ_ЦепочкиДокументовПоставщика КАК ЭКОМ_ЦепочкиДокументовПоставщика
|        ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_GLN КАК ЭКОМ_GLN
|        ПО (ЭКОМ_ЦепочкиДокументовПоставщика.Контрагент = ЭКОМ_GLN.Объект)
|        ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
|            ЭКОМ_Палеты.Документ КАК Документ
|        ИЗ
|            РегистрСведений.ЭКОМ_Палеты КАК ЭКОМ_Палеты
|
|        СГРУППИРОВАТЬ ПО
|            ЭКОМ_Палеты.Документ) КАК Палеты
|        ПО (ЭКОМ_ЦепочкиДокументовПоставщика.Накладная = Палеты.Документ)
|        ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_Объекты_События КАК ЭКОМ_Объекты_СобытияУточнение
|        ПО ЭКОМ_ЦепочкиДокументовПоставщика.СЧФ = ЭКОМ_Объекты_СобытияУточнение.Документ_Основание
|            И (ЭКОМ_Объекты_СобытияУточнение.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.DP_UVUTOCH_09))
|ГДЕ
|    ЭКОМ_ЦепочкиДокументовПоставщика.ORDERDATE МЕЖДУ &ДатаНач И &ДатаКон";

ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Заказ_ПустаяСсылка", "Значение(Документ.ЗаказКлиента.ПустаяСсылка)");
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Накладная_ПустаяСсылка", "Значение(Документ.РеализацияТоваровУслуг.ПустаяСсылка)");
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&RECADV_ПустаяСсылка", "Значение(Документ.ЭКОМ_Документы.ПустаяСсылка)");
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СЧФ_ПустаяСсылка", "Значение(Документ.СчетФактураВыданный.ПустаяСсылка)");
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Накладная_Кор_ПустаяСсылка", "Значение(Документ.КорректировкаРеализации.ПустаяСсылка)");
