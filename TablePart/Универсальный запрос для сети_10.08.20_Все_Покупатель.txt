
// Необходимо указать типы документов для конфигурации 1с (Пример для УТ 10.3 и БП 3.0)
ИмяПоступления1С     = "Значение(Документ.ПоступлениеТоваровУслуг.ПустаяСсылка)";
ИмяЭКОМ_Документа    = "Значение(Документ.ЭКОМ_Документы.ПустаяСсылка)";
ИмяСчетФактуры1С     = "Значение(Документ.СчетФактураПолученный.ПустаяСсылка)";

ТекстЗапроса = "ВЫБРАТЬ
               |	ЭКОМ_ЦепочкаПокупателя.ORDERDATE КАК ДатаЗаказа,
               |	ЭКОМ_ЦепочкаПокупателя.ORDERNUMBER КАК НомерЗаказа,
               |	ЭКОМ_ЦепочкаПокупателя.Заказ КАК ДокументЗаказа,
               |	ЭКОМ_ЦепочкаПокупателя.ORDRSP КАК ЭКОМ_Документ_ORDRSP,
               |	ЭКОМ_ЦепочкаПокупателя.DESADV КАК ЭКОМ_Документ_DESADV,
               |	ЭКОМ_ЦепочкаПокупателя.ВозвратнаяНакладная КАК ВозвратТоваровПоставщику,
               |	ЭКОМ_ЦепочкаПокупателя.Накладная КАК ДокументПоступления,
               |	ВЫБОР
               |		КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД_Основание = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА НЕОПРЕДЕЛЕНО
               |		ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Накладная
               |	КОНЕЦ КАК КорректировкаПоступления,
               |	ЭКОМ_ЦепочкаПокупателя.ДатаПоставки КАК ДатаПоставки,
               |	ЭКОМ_ЦепочкаПокупателя.КоличествоЗаказ КАК Заказано,
               |	ЭКОМ_ЦепочкаПокупателя.КоличествоНакладная КАК Принято,
               |	ЭКОМ_ЦепочкаПокупателя.КоличествоDESADV КАК Отгружено,
               |	ЭКОМ_ЦепочкаПокупателя.Контрагент КАК Контрагент,
               |	ЭКОМ_ЦепочкаПокупателя.Организация КАК Организация,
               |	ЭКОМ_ЦепочкаПокупателя.ТочкаДоставки КАК ТочкаДоставки,
               |	ЭКОМ_ЦепочкаПокупателя.НомерИсправления КАК НомерИсправления,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_DESADV КАК Статус_DESADV,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_ORDER КАК Статус_ORDER,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_ORDRSP КАК Статус_ORDRSP,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_RECADV КАК Статус_RECADV,
               |	ВЫРАЗИТЬ (ЭКОМ_ЦепочкаПокупателя.СуммаЗаказ КАК ЧИСЛО(15, 2)) КАК СуммаЗаказ,
               |	ВЫРАЗИТЬ (ЭКОМ_ЦепочкаПокупателя.СуммаНакладная КАК ЧИСЛО(15, 2)) КАК СуммаНакладная,
               |	ВЫРАЗИТЬ (ЭКОМ_ЦепочкаПокупателя.СуммаСЧФ КАК ЧИСЛО(15, 2)) КАК СуммаСЧФ,
               |	ЭКОМ_ЦепочкаПокупателя.ТекстОшибки КАК ТекстОшибки,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД КАК ДокументЭКОМ_ЮЗД,
               |	ЭКОМ_ЦепочкаПокупателя.СтатусЮЗД  КАК Статус_УПД,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.СЧФ = &СЧФ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.СЧФ
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.Накладная = &Накладная_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.Накладная
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.DESADV = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.DESADV
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ORDRSP = &ЭКОМ_Документ_ПустаяСсылка
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.ORDRSP
               |		ИНАЧЕ ЭКОМ_ЦепочкаПокупателя.Заказ
               |	КОНЕЦ КАК Ссылка,
               |	ЭКОМ_ЦепочкаПокупателя.СЧФ КАК ДокументСЧФ,
               |	ВЫБОР
               |		КОГДА НЕ ЭКОМ_ЦепочкаПокупателя.ТекстОшибки = """"
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК ЕстьОшибка,
               |	ВЫРАЗИТЬ (ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего КАК ЧИСЛО(15, 2)) КАК СуммаЮЗД_XML,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД.СЧФНомер КАК СЧФ_Номер,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД.СЧФДата КАК СЧФ_Дата,
               |	ВЫРАЗИТЬ (ВЫБОР
               |		КОГДА ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего > 0
               |			ТОГДА ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего
               |		ИНАЧЕ -(ЭКОМ_ЦепочкаПокупателя.СуммаНакладная - ЭКОМ_ЦепочкаПокупателя.ЮЗД.СуммаДокументаВсего)
               |	КОНЕЦ КАК ЧИСЛО(15, 2)) КАК Дельта,
               |	ЭКОМ_ЦепочкаПокупателя.Статус_STATUS КАК Статус_STATUS,
               |	ВЫБОР
               |		КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД.ВидДокумента В (ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Испр), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Испр))
               |			ТОГДА ИСТИНА
               |		КОГДА ЭКОМ_ЦепочкаПокупателя.ЮЗД_Основание.ВидДокумента В (ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Испр), ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Испр))
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК ЭтоМаркируемыйЮЗД,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД.ВидДокумента КАК ЮЗДВидДокумента,
               |	ЭКОМ_ЦепочкаПокупателя.ЮЗД.ИнформацияПоДокументу КАК СтатусДокументооборота,
               |	ЭКОМ_ЦепочкаПокупателя.ТекстОтклоненияАннулирования КАК ТекстОтклоненияАннулирования,
               |	ЭКОМ_ЦепочкаПокупателя.ТекстПричиныАннулирования КАК ТекстПричиныАннулирования
               |ИЗ
               |	РегистрСведений.ЭКОМ_ЦепочкиДокументовПокупателя КАК ЭКОМ_ЦепочкаПокупателя";

ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Накладная_ПустаяСсылка"    , ИмяПоступления1С);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ЭКОМ_Документ_ПустаяСсылка", ИмяЭКОМ_Документа);
ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СЧФ_ПустаяСсылка"          , ИмяСчетФактуры1С);

