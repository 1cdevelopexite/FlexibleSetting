//УТ 10.3
	ИмяЗаказа1С          = "Сделка";
	ИмяОрганизации		 = "Организация";
	ИмяКонтрагента		 = "Контрагент";
	ИмяТочкиДоставки	 = "Грузополучатель";
	НомерЗаказа1С        = "НомерВходящегоДокументаЭлектронногоОбмена";
	ДатаЗаказа1С         = "ДатаВходящегоДокументаЭлектронногоОбмена";
	ДокументОснованиеСЧФ = "ДокументОснование";
	
	Если Тип_ДокументЭКОМ.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
		
		//ORDER
		Если Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ORDER_Входящий Тогда
			НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.ORDERDATE.Установить(Источник.ЗаказДата);
			НаборЗаписей.Отбор.ORDERNUMBER.Установить(Источник.ЗаказНомер);
			НаборЗаписей.Отбор.ORDER.Установить(Источник.Ссылка);
			
			//Выполним блокировку данных
			ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПоставщика");
			
			НаборЗаписей.Прочитать();
			
			// Если существует документ в регистре
			Для Каждого НоваяЗапись Из НаборЗаписей Цикл
				НоваяЗапись.ДатаПоставки  = Источник.ДатаПоставки;
				НоваяЗапись.Организация   = Источник.Организация;
				НоваяЗапись.Контрагент    = Источник.Контрагент;
				НоваяЗапись.ТочкаДоставки = Источник.ТочкаДоставки;
				
				НоваяЗапись.КоличествоORDER = Источник.ТЧ_Товары.Итог("КоличествоЗаказанное");
				НоваяЗапись.СуммаORDER = Источник.ТЧ_Товары.Итог("Сумма_с_НДС");
			КонецЦикла;	
			
			// Записываем документ в первый раз
			Если НаборЗаписей.Количество() = 0 Тогда
				НоваяЗапись = НаборЗаписей.Добавить();
				НоваяЗапись.ORDERDATE   = Источник.ЗаказДата;
				НоваяЗапись.ORDERNUMBER = Источник.ЗаказНомер;
				НоваяЗапись.ORDER       = Источник.Ссылка;
				
				НоваяЗапись.xmlОрганизация   = Источник.xmlОрганизация;
				НоваяЗапись.xmlКонтрагент    = Источник.xmlКонтрагент;
				НоваяЗапись.xmlТочкаДоставки = Источник.xmlТочкаДоставки;
				НоваяЗапись.ДатаПоставки     = Источник.ДатаПоставки;
				НоваяЗапись.Организация      = Источник.Организация;
				НоваяЗапись.Контрагент       = Источник.Контрагент;
				НоваяЗапись.ТочкаДоставки    = Источник.ТочкаДоставки;
				НоваяЗапись.КоличествоORDER  = Источник.ТЧ_Товары.Итог("КоличествоЗаказанное");
				НоваяЗапись.СуммаORDER       = Источник.ТЧ_Товары.Итог("Сумма_с_НДС");
			КонецЕсли;
			
			НаборЗаписей.Записать();	
		КонецЕсли;	
		
		//RECADV
		Если Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.RECADV_Входящий Тогда
			
			Если Источник.ДокументыСвязанные.Количество() > 0 Тогда
				РТУ = Источник.ДокументыСвязанные[0].ДокументСвязанный;
				
				// ЗаказДата и ЗаказНомер заполняем в гибких настройках при загрузке документа!
				НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
				НаборЗаписей.Отбор.ORDERDATE.Установить(Источник.ЗаказДата);
				НаборЗаписей.Отбор.ORDERNUMBER.Установить(Источник.ЗаказНомер);
				НаборЗаписей.Отбор.Накладная.Установить(РТУ);
				
				//Выполним блокировку данных
				ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПоставщика");
				
				НаборЗаписей.Прочитать();
				
				// Если существует документ в регистре
				Для Каждого НоваяЗапись Из НаборЗаписей Цикл
					НоваяЗапись.Организация   = Источник.Организация;
					НоваяЗапись.Контрагент    = Источник.Контрагент;
					НоваяЗапись.ТочкаДоставки = Источник.ТочкаДоставки;
					
					НоваяЗапись.RECADV           = Источник.Ссылка;
					НоваяЗапись.КоличествоRECADV = Источник.ТЧ_Товары.Итог("КоличествоПринятое");
					НоваяЗапись.СуммаRECADV      = Источник.ТЧ_Товары.Итог("Сумма_с_НДС");
					
					НаборЗаписей.Записать();
				КонецЦикла;	
				
				// Документ не найден в цепочке
				Если НаборЗаписей.Количество() = 0 Тогда
					Сообщить("Цепочка не найдена для документа RECADV - " + Строка(Источник.Ссылка));
				КонецЕсли;
	
			КонецЕсли;	
						
		КонецЕсли;	
		
		//RETANN
		Если Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.RETANN_Входящий Тогда
			
			Если Источник.ДокументыСвязанные.Количество() > 0 Тогда
				РТУ = Источник.ДокументыСвязанные[0].ДокументСвязанный;
				
				// ЗаказДата и ЗаказНомер заполняем в гибких настройках при загрузке документа!
				НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
				НаборЗаписей.Отбор.ORDERDATE.Установить(Источник.ЗаказДата);
				НаборЗаписей.Отбор.ORDERNUMBER.Установить(Источник.ЗаказНомер);
				НаборЗаписей.Отбор.Накладная.Установить(РТУ);
				
				//Выполним блокировку данных
				ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПоставщика");
				
				НаборЗаписей.Прочитать();
				
				// Если существует документ в регистре
				Для Каждого НоваяЗапись Из НаборЗаписей Цикл
					НоваяЗапись.Организация   = Источник.Организация;
					НоваяЗапись.Контрагент    = Источник.Контрагент;
					НоваяЗапись.ТочкаДоставки = Источник.ТочкаДоставки;
					
					НоваяЗапись.RETANN           = Источник.Ссылка;
					НоваяЗапись.КоличествоRETANN = Источник.ТЧ_Товары.Итог("КоличествоПринятое");
					НоваяЗапись.СуммаRETANN      = Источник.ТЧ_Товары.Итог("Сумма_с_НДС"); 
					
					НаборЗаписей.Записать();
				КонецЦикла;	
				
				// Документ не найден в цепочке
				Если НаборЗаписей.Количество() = 0 Тогда
					Сообщить("Цепочка не найдена для документа RETANN - " + Строка(Источник.Ссылка));
				КонецЕсли;
				
			КонецЕсли;	
			
		КонецЕсли;	
		
	КонецЕсли;	
	
	//Заказ покупателя
	Если Тип_Заказ.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
					
		НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.ORDERDATE.Установить(Источник[ДатаЗаказа1С]);
		НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
		НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
		НаборЗаписей.Отбор.ТочкаДоставки.Установить(Источник[ИмяТочкиДоставки]);
		НаборЗаписей.Отбор.ORDERNUMBER.Установить(Источник[НомерЗаказа1С]);
		
		//Выполним блокировку данных
		ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПоставщика");
		
		НаборЗаписей.Прочитать();
		
		// Если существует запись в регистре
		Для Каждого НоваяЗапись Из НаборЗаписей Цикл
			
			НоваяЗапись.Организация   = Источник.Организация;
			НоваяЗапись.Контрагент    = Источник.Контрагент;
			НоваяЗапись.ТочкаДоставки = Источник[ИмяТочкиДоставки];
				                         
			НоваяЗапись.Заказ           = Источник.Ссылка;
			НоваяЗапись.КоличествоЗаказ = Источник.Товары.Итог("Количество");
			НоваяЗапись.СуммаЗаказ      = Источник.Товары.Итог("Сумма");
			
			НаборЗаписей.Записать();
		КонецЦикла;	

		// Запись не найдена в цепочке
		Если НаборЗаписей.Количество() = 0 Тогда
			// Сообщать только для тестирования 
			//Сообщить("Не найден документ ЭКОМ(ORDER) или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПоставщика""", СтатусСообщения.ОченьВажное);			
		КонецЕсли;		
		
	КонецЕсли;	
	
	//Реализация товаров и услуг
	Если Тип_Накладная.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
		
		НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
		НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
		НаборЗаписей.Отбор.ТочкаДоставки.Установить(Источник[ИмяТочкиДоставки]);
        НаборЗаписей.Отбор.Заказ.Установить(Источник[ИмяЗаказа1С]); 					
		
		//Выполним блокировку данных
		ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПоставщика");
		
		НаборЗаписей.Прочитать();
		
		// Если существует запись в регистре
		Для Каждого НоваяЗапись Из НаборЗаписей Цикл
			
			НоваяЗапись.Организация   = Источник.Организация;
			НоваяЗапись.Контрагент    = Источник.Контрагент;
			НоваяЗапись.ТочкаДоставки = Источник[ИмяТочкиДоставки];
			
			НоваяЗапись.Накладная           = Источник.Ссылка;
			НоваяЗапись.КоличествоНакладная = Источник.Товары.Итог("Количество");
			НоваяЗапись.СуммаНакладная      = Источник.Товары.Итог("Сумма"); 
			НоваяЗапись.СуммаНДСНакладная   = Источник.Товары.Итог("СуммаНДС"); 
			
			НаборЗаписей.Записать();
		КонецЦикла;	

		// Запись не найдена в цепочке
		Если НаборЗаписей.Количество() = 0 Тогда
			// Сообщать только для тестирования 
			//Сообщить("Не найден документ Заказ покупателя или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПоставщика""", СтатусСообщения.ОченьВажное);			
		КонецЕсли;
			
	КонецЕсли;
	
	//Корректировка реализации
	Если Тип_Накладная_Кор.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
		
		РТУ = ПолучитьИсправляемыйДокументРеализации(Источник,,"ДокументРеализации");
		ЗаказПокупателя = РТУ[ИмяЗаказа1С];
				
		НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
		НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
		НаборЗаписей.Отбор.ТочкаДоставки.Установить(Источник[ИмяТочкиДоставки]);
		НаборЗаписей.Отбор.Заказ.Установить(ЗаказПокупателя);
		НаборЗаписей.Отбор.Накладная.Установить(РТУ);
		
		//Выполним блокировку данных
		ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПоставщика");
		
		НаборЗаписей.Прочитать();
		
		// Если существует запись в регистре
		Для Каждого НоваяЗапись Из НаборЗаписей Цикл
			
			НоваяЗапись.Организация   = Источник.Организация;
			НоваяЗапись.Контрагент    = Источник.Контрагент;
			НоваяЗапись.ТочкаДоставки = Источник[ИмяТочкиДоставки];
			
			НоваяЗапись.Накладная_Кор           = Источник.Ссылка;
			НоваяЗапись.КоличествоНакладная_Кор = Источник.Товары.Итог("Количество");
			НоваяЗапись.СуммаНакладная_Кор      = Источник.Товары.Итог("Сумма"); 
			НоваяЗапись.СуммаНДСНакладная_Кор   = Источник.Товары.Итог("СуммаНДС"); 
			
			НаборЗаписей.Записать();
		КонецЦикла;	

		// Запись не найдена в цепочке
		Если НаборЗаписей.Количество() = 0 Тогда
			// Сообщать только для тестирования 
			//Сообщить("Не найден документ Заказ покупателя или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПоставщика""", СтатусСообщения.ОченьВажное);			
		КонецЕсли;		
		
	КонецЕсли;
	
	//СчетФактураВыданный
	Если Тип_СЧФ.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
		
		ДокументОснование = Источник[ДокументОснованиеСЧФ];
		
		Если Тип_Накладная.СодержитТип(ТипЗнч(ДокументОснование)) Тогда
			
			РТУ = ДокументОснование;
			ЗаказПокупателя = РТУ[ИмяЗаказа1С];		
			
			НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
			НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
			НаборЗаписей.Отбор.ТочкаДоставки.Установить(РТУ[ИмяТочкиДоставки]);
			НаборЗаписей.Отбор.Заказ.Установить(ЗаказПокупателя);
			НаборЗаписей.Отбор.Накладная.Установить(РТУ);
				
			//Выполним блокировку данных
			ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПоставщика");
			
			НаборЗаписей.Прочитать();
			
			// Если существует запись в регистре
			Для Каждого НоваяЗапись Из НаборЗаписей Цикл
				
				НоваяЗапись.Организация   = Источник.Организация;
				НоваяЗапись.Контрагент    = Источник.Контрагент;
				НоваяЗапись.ТочкаДоставки = РТУ[ИмяТочкиДоставки];
				
				НоваяЗапись.СЧФ      = Источник.Ссылка;
				НоваяЗапись.СуммаСЧФ = Источник.СуммаДокумента;
				
				НаборЗаписей.Записать();
			КонецЦикла;	
			
			// Запись не найдена в цепочке
			Если НаборЗаписей.Количество() = 0 Тогда
				// Сообщать только для тестирования 
				//Сообщить("Не найден документ Реализации товаров и услуг или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПоставщика""", СтатусСообщения.ОченьВажное);			
			КонецЕсли;		
			
		КонецЕсли;
		
		Если Тип_Накладная_Кор.СодержитТип(ТипЗнч(ДокументОснование)) Тогда
			
			РТУ = ПолучитьИсправляемыйДокументРеализации(ДокументОснование,,"ДокументРеализации");
			ЗаказПокупателя = РТУ[ИмяЗаказа1С];
			
			НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
			НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
			НаборЗаписей.Отбор.ТочкаДоставки.Установить(РТУ[ИмяТочкиДоставки]);
			НаборЗаписей.Отбор.Заказ.Установить(ЗаказПокупателя);
			НаборЗаписей.Отбор.Накладная.Установить(РТУ);
			НаборЗаписей.Отбор.Накладная_Кор.Установить(ДокументОснование);
						
			//Выполним блокировку данных
			ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПоставщика");
			
			НаборЗаписей.Прочитать();
			
			// Если существует запись в регистре
			Для Каждого НоваяЗапись Из НаборЗаписей Цикл
				
				НоваяЗапись.Организация   = Источник.Организация;
				НоваяЗапись.Контрагент    = Источник.Контрагент;
				НоваяЗапись.ТочкаДоставки = РТУ[ИмяТочкиДоставки];
				
				НоваяЗапись.СЧФ_Кор          = Источник.Ссылка;
				НоваяЗапись.СуммаСЧФ_Кор     = Источник.СуммаДокумента;
				НоваяЗапись.НомерИсправления = Источник.НомерИсправления;
				
				НаборЗаписей.Записать();
			КонецЦикла;	
			
			// Запись не найдена в цепочке
			Если НаборЗаписей.Количество() = 0 Тогда
				// Сообщать только для тестирования 
				//Сообщить("Не найден документ Корректировка реализации товаров и услуг или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПоставщика""", СтатусСообщения.ОченьВажное);			
			КонецЕсли;		
			
		КонецЕсли;
		
	КонецЕсли;