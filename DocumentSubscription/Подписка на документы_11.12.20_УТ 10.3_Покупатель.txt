    // БП 3.0
    //ТипДокументаЭКОМ = "ДокументСсылка.ЭКОМ_Документы";
	//ИмяОрганизации   = "Организация";
	//ИмяКонтрагента   = "Контрагент";
	//ИмяТочкиДоставки = "ДоговорКонтрагента";
	//ИмяЗаказа1С      = "СчетНаОплатуПоставщика";
	//ИмяДатаПоставки  = "Дата";
	//ДатаЗаказа1С     = "Дата";
	//НомерЗаказа1С    = "Номер";
	//ДокументОснованиеСЧФ = "ДокументОснование";
	
	//УТ 10.2
	ТипДокументаЭКОМ = "ДокументСсылка.ЭКОМ_Документы";
	ИмяОрганизации		 = "Организация";       
    ИмяКонтрагента		 = "Контрагент";
	ИмяТочкиДоставки	 = "Склад";
	//ИмяЗаказа1С	     = "Заказ";
	НомерЗаказа1С        = "Номер";
	ДатаЗаказа1С         = "Дата";
	ДокументОснованиеСЧФ = "ДокументОснование";
	ИмяДатаПоставки      = "Дата";
	
	// Солнечный круг
	ИмяЗаказа1С	         = "Сделка";

	//УТ 11.4
	//ТипДокументаЭКОМ = "ДокументСсылка.ЭКОМ_Документы";
	//ИмяОрганизации   = "Организация";
	//ИмяКонтрагента   = "Контрагент";
	//ИмяТочкиДоставки = "Склад";
	//ИмяЗаказа1С      = "ЗаказПоставщику";
	//ИмяДатаПоставки  = "ЖелаемаяДатаПоступления";
	//ДатаЗаказа1С     = "ДатаПоДаннымКлиента";
	//НомерЗаказа1С    = "НомерПоДаннымКлиента";
	
	//Заказ поставщику
	Если Тип_Заказ.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
		
		НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПокупателя.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.ORDERDATE.Установить(Источник[ДатаЗаказа1С]);
		НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
		НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
		НаборЗаписей.Отбор.ТочкаДоставки.Установить(Источник[ИмяТочкиДоставки]);
		НаборЗаписей.Отбор.ORDERNUMBER.Установить(Источник[НомерЗаказа1С]);
		НаборЗаписей.Отбор.Заказ.Установить(Источник.Ссылка);
		
		//Выполним блокировку данных
		ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПокупателя");
		
		НаборЗаписей.Прочитать();
		
		// Если существует документ в регистре
		Для Каждого НоваяЗапись Из НаборЗаписей Цикл
			НоваяЗапись.ДатаПоставки    = Источник[ИмяДатаПоставки];
			НоваяЗапись.КоличествоЗаказ = Источник.Товары.Итог("Количество");
			НоваяЗапись.СуммаЗаказ      = Источник.Товары.Итог("Сумма");
		КонецЦикла;	
		
		// Записываем документ в первый раз
		Если НаборЗаписей.Количество() = 0 Тогда
			НоваяЗапись = НаборЗаписей.Добавить();
			
			НоваяЗапись.ORDERDATE     = Источник[ДатаЗаказа1С];
			НоваяЗапись.Организация   = Источник[ИмяОрганизации];
			НоваяЗапись.Контрагент    = Источник[ИмяКонтрагента];
			НоваяЗапись.ТочкаДоставки = Источник[ИмяТочкиДоставки];
			НоваяЗапись.ORDERNUMBER   = Источник[НомерЗаказа1С];
			НоваяЗапись.Заказ         = Источник.Ссылка;
			
			НоваяЗапись.ДатаПоставки = Источник[ИмяДатаПоставки];
			НоваяЗапись.КоличествоЗаказ = Источник.Товары.Итог("Количество");
			НоваяЗапись.СуммаЗаказ      = Источник.Товары.Итог("Сумма");
		КонецЕсли;
		
		НаборЗаписей.Записать();	
		
	КонецЕсли;	
	
	Если ТипЗнч(Источник.Ссылка) = Тип(ТипДокументаЭКОМ) Тогда
		
		//ORDRSP
		Если Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ORDRSP_Входящий Тогда
			
			Если ЗначениеЗаполнено(Источник.Документ1С) Тогда
				Заказ1С = Источник.Документ1С;
				
				НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПокупателя.СоздатьНаборЗаписей();
				НаборЗаписей.Отбор.ORDERDATE.Установить(Заказ1С[ДатаЗаказа1С]);
				НаборЗаписей.Отбор.ORDERNUMBER.Установить(Заказ1С[НомерЗаказа1С]);
				НаборЗаписей.Отбор.Заказ.Установить(Заказ1С);
				
				//Выполним блокировку данных
				ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПокупателя");
				
				НаборЗаписей.Прочитать();
				
				// Если существует документ в регистре
				Для Каждого НоваяЗапись Из НаборЗаписей Цикл
					НоваяЗапись.Организация      = Источник.Организация;
					НоваяЗапись.Контрагент       = Источник.Контрагент;
					НоваяЗапись.ТочкаДоставки    = Источник.ТочкаДоставки;
					НоваяЗапись.xmlОрганизация   = Источник.xmlОрганизация;
					НоваяЗапись.xmlКонтрагент    = Источник.xmlКонтрагент;
					НоваяЗапись.xmlТочкаДоставки = Источник.xmlТочкаДоставки;					
					НоваяЗапись.ORDRSP           = Источник.Ссылка;
					НоваяЗапись.КоличествоORDRSP = Источник.ТЧ_Товары.Итог("КоличествоПоставляемое");
					НоваяЗапись.СуммаORDRSP      = Источник.ТЧ_Товары.Итог("Сумма_с_НДС"); 
					
					НаборЗаписей.Записать();
				КонецЦикла;	
				
				// Документ не найден в цепочке
				Если НаборЗаписей.Количество() = 0 Тогда
					Сообщить("Цепочка не найдена для документа ORDRSP - " + Строка(Источник.Ссылка));
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЕсли;	
		
		//DESADV
		Если Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.DESADV_Входящий Тогда
			
			Если ЗначениеЗаполнено(Источник.Документ1С) Тогда
				
				Заказ1С = Источник.Документ1С;
				
				НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПокупателя.СоздатьНаборЗаписей();
				НаборЗаписей.Отбор.ORDERDATE.Установить(Заказ1С[ДатаЗаказа1С]);
				НаборЗаписей.Отбор.ORDERNUMBER.Установить(Заказ1С[НомерЗаказа1С]);
				НаборЗаписей.Отбор.Заказ.Установить(Заказ1С);
				
				//Выполним блокировку данных
				ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПокупателя");
				
				НаборЗаписей.Прочитать();
				
				// Если существует документ в регистре
				Для Каждого НоваяЗапись Из НаборЗаписей Цикл
					
					Если Источник.ДокументыСвязанные.Количество() > 0 Тогда
						НоваяЗапись.Накладная   = Источник.ДокументыСвязанные[0].ДокументСвязанный;
					КонецЕсли;	
					
					НоваяЗапись.Организация      = Источник.Организация;
					НоваяЗапись.Контрагент       = Источник.Контрагент;
					НоваяЗапись.ТочкаДоставки    = Источник.ТочкаДоставки;
					НоваяЗапись.xmlОрганизация   = Источник.xmlОрганизация;
					НоваяЗапись.xmlКонтрагент    = Источник.xmlКонтрагент;
					НоваяЗапись.xmlТочкаДоставки = Источник.xmlТочкаДоставки;
					НоваяЗапись.DESADV           = Источник.Ссылка;
					НоваяЗапись.КоличествоDESADV = Источник.ТЧ_Товары.Итог("КоличествоПринятое");
					НоваяЗапись.СуммаDESADV      = Источник.ТЧ_Товары.Итог("Сумма_с_НДС"); 
					
					НаборЗаписей.Записать();
				КонецЦикла;	
				
				// Документ не найден в цепочке
				Если НаборЗаписей.Количество() = 0 Тогда
					Сообщить("Цепочка не найдена для документа DESADV - " + Строка(Источник.Ссылка));
				КонецЕсли;
				
			КонецЕсли;	
			
		КонецЕсли;	
		
		//ON_NSCHFDOPPR_01
		Если Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPR_01 
			ИЛИ Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPR_01_Испр
			ИЛИ Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_KORSCHFDOPPR_01
			ИЛИ Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_KORSCHFDOPPR_01_Испр
			ИЛИ Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01 
			ИЛИ Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Испр 
			ИЛИ Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01 
			ИЛИ Источник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Испр Тогда
					
		    ДокПН = Неопределено;
			Если Источник.ДокументыСвязанные.Количество() > 0 Тогда
				ДокПН  = Источник.ДокументыСвязанные[0].ДокументСвязанный;
			КонецЕсли;
			
			ДокСЧФ = Неопределено;
			Если ЗначениеЗаполнено(Источник.Документ1С) Тогда
				ДокСЧФ  = Источник.Документ1С;
			КонецЕсли;
					
			НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПокупателя.СоздатьНаборЗаписей();
			
			ДанныеОтбораЗаполнены = Ложь;
			СтруктураОтборов = Новый Структура;
			СтруктураОтборов.Вставить("Накладная"    , ДокПН);
			СтруктураОтборов.Вставить("Организация"  , Источник.Организация);
			СтруктураОтборов.Вставить("Контрагент"   , Источник.Контрагент);
			СтруктураОтборов.Вставить("ТочкаДоставки", Источник.ТочкаДоставки);
			СтруктураОтборов.Вставить("СЧФ"          , ДокСЧФ);
			Для каждого Данные Из СтруктураОтборов Цикл
				Если ЗначениеЗаполнено(Данные.Значение) Тогда
					НаборЗаписей.Отбор[Данные.Ключ].Установить(Данные.Значение);
					ДанныеОтбораЗаполнены = Истина;
				КонецЕсли;
			КонецЦикла;
			
			Если ДанныеОтбораЗаполнены 
				И (ЗначениеЗаполнено(ДокПН) ИЛИ ЗначениеЗаполнено(ДокСЧФ)) Тогда
				
				НачатьТранзакцию();
				Попытка
					//Выполним блокировку данных
					ЭКОМ_ПодпискаСобытий.ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПокупателя");
					
					ЗафиксироватьТранзакцию();
					
				Исключение
					ОтменитьТранзакцию();
					Сообщить("Кто-то только что запустил получение.");
				КонецПопытки;
				
				НаборЗаписей.Прочитать();
				
				// Если существует документ в регистре
				Для Каждого НоваяЗапись Из НаборЗаписей Цикл
					
					НоваяЗапись.Организация   = Источник.Организация;
					НоваяЗапись.Контрагент    = Источник.Контрагент;
					НоваяЗапись.ТочкаДоставки = Источник.ТочкаДоставки;
					НоваяЗапись.Накладная     = ДокПН;
					НоваяЗапись.СЧФ           = ДокСЧФ;
					НоваяЗапись.ЮЗД           = Источник.Ссылка;
					НоваяЗапись.СуммаСЧФ      = Источник.ТЧ_Товары.Итог("КоличествоПринятое");				
					
				КонецЦикла;	
				
				// Записываем документ в первый раз
				Если НаборЗаписей.Количество() = 0 
					И (ЗначениеЗаполнено(ДокПН) ИЛИ ЗначениеЗаполнено(ДокСЧФ)) Тогда
					НоваяЗапись = НаборЗаписей.Добавить();
					НоваяЗапись.Организация   = Источник.Организация;
					НоваяЗапись.Контрагент    = Источник.Контрагент;
					НоваяЗапись.ТочкаДоставки = Источник.ТочкаДоставки;
					НоваяЗапись.Накладная     = ДокПН;
					НоваяЗапись.СЧФ           = ДокСЧФ;
					НоваяЗапись.ЮЗД           = Источник.Ссылка;
					НоваяЗапись.СуммаСЧФ      = Источник.ТЧ_Товары.Итог("КоличествоПринятое");
					
				КонецЕсли;
				
				НаборЗаписей.Записать();
			КонецЕсли;	
				
		КонецЕсли;	
		
	КонецЕсли;	
	
	//Поступления товаров и услуг
	Если Тип_Накладная.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
		
		Заказ1С = Источник[ИмяЗаказа1С];
		
		НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПокупателя.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.ORDERDATE.Установить(Заказ1С[ДатаЗаказа1С]);
		НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
		НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
		НаборЗаписей.Отбор.ТочкаДоставки.Установить(Источник[ИмяТочкиДоставки]);
		НаборЗаписей.Отбор.ORDERNUMBER.Установить(Заказ1С[НомерЗаказа1С]);
		НаборЗаписей.Отбор.Заказ.Установить(Заказ1С);
		
		//Выполним блокировку данных
		ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПокупателя");
		
		НаборЗаписей.Прочитать();
		
		// Если существует запись в регистре
		Для Каждого НоваяЗапись Из НаборЗаписей Цикл
			
			НоваяЗапись.Накладная           = Источник.Ссылка;
			НоваяЗапись.КоличествоНакладная = Источник.Товары.Итог("Количество");
			НоваяЗапись.СуммаНакладная      = Источник.Товары.Итог("Сумма"); 
			НоваяЗапись.СуммаНДСНакладная   = Источник.Товары.Итог("СуммаНДС"); 
			
			НаборЗаписей.Записать();
		КонецЦикла;	
		
		// Запись не найдена в цепочке
		//Если НаборЗаписей.Количество() = 0 Тогда
		//	Сообщить("Не найден документ Заказ покупателя или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПоставщика""", СтатусСообщения.ОченьВажное);			
		//КонецЕсли;		
		
	КонецЕсли;
	
	//Корректировка поступления
//	Если Тип_Накладная_Кор.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
//		
//		ПТУ     = ПолучитьИсправляемыйДокументПоступления(Источник,,"ДокументПоступления");
//		Заказ1С = ПТУ[ИмяЗаказа1С];
//		
//		НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПокупателя.СоздатьНаборЗаписей();
//		НаборЗаписей.Отбор.ORDERDATE.Установить(Заказ1С[ДатаЗаказа1С]);
//		НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
//		НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
//		НаборЗаписей.Отбор.ТочкаДоставки.Установить(Источник[ИмяТочкиДоставки]);
//		НаборЗаписей.Отбор.ORDERNUMBER.Установить(Заказ1С[НомерЗаказа1С]);
//		НаборЗаписей.Отбор.Заказ.Установить(Заказ1С);
//		НаборЗаписей.Отбор.Накладная.Установить(ПТУ);
//		
//		//Выполним блокировку данных
//		ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПокупателя");
//		
//		НаборЗаписей.Прочитать();
//		
//		// Если существует запись в регистре
//		Для Каждого НоваяЗапись Из НаборЗаписей Цикл
//			
//			НоваяЗапись.Накладная_Кор           = Источник.Ссылка;
//			НоваяЗапись.КоличествоНакладная_Кор = Источник.Товары.Итог("Количество");
//			НоваяЗапись.СуммаНакладная_Кор      = Источник.Товары.Итог("Сумма"); 
//			НоваяЗапись.СуммаНДСНакладная_Кор   = Источник.Товары.Итог("СуммаНДС"); 
//			
//			НаборЗаписей.Записать();
//		КонецЦикла;	
//		
//		// Запись не найдена в цепочке
//		Если НаборЗаписей.Количество() = 0 Тогда
//			Сообщить("Не найден документ Заказ покупателя или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПоставщика""", СтатусСообщения.ОченьВажное);			
//		КонецЕсли;		
//		
//	КонецЕсли;
	
	//СчетФактураПолученный
	Если Тип_СЧФ.СодержитТип(ТипЗнч(Источник.Ссылка)) Тогда
		
		ДокументОснование = Источник[ДокументОснованиеСЧФ];
		
		Если Тип_Накладная.СодержитТип(ТипЗнч(ДокументОснование)) Тогда
			
			ПТУ     = ДокументОснование;
			Заказ1С = ПТУ[ИмяЗаказа1С];
			
			НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПокупателя.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.ORDERDATE.Установить(Заказ1С[ДатаЗаказа1С]);
			НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
			НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
			НаборЗаписей.Отбор.ТочкаДоставки.Установить(Заказ1С[ИмяТочкиДоставки]);
			НаборЗаписей.Отбор.ORDERNUMBER.Установить(Заказ1С[НомерЗаказа1С]);
			НаборЗаписей.Отбор.Заказ.Установить(Заказ1С);
			НаборЗаписей.Отбор.Накладная.Установить(ПТУ);
			
			//Выполним блокировку данных
			ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПокупателя");
			
			НаборЗаписей.Прочитать();
			
			// Если существует запись в регистре
			Для Каждого НоваяЗапись Из НаборЗаписей Цикл
				
				НоваяЗапись.СЧФ = Источник.Ссылка;
				НоваяЗапись.СуммаСЧФ = Источник.СуммаДокумента;
				
				НаборЗаписей.Записать();
			КонецЦикла;	
			
			// Запись не найдена в цепочке
			//Если НаборЗаписей.Количество() = 0 Тогда
			//	Сообщить("Не найден документ Поступления товаров и услуг или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПокупателя""", СтатусСообщения.ОченьВажное);			
			//КонецЕсли;		
			
		КонецЕсли;
		
//		Если Тип_Накладная_Кор.СодержитТип(ТипЗнч(ДокументОснование)) Тогда
//			
//			ПТУ = ПолучитьИсправляемыйДокументПоступления(ДокументОснование,,"ДокументПоступления");
//			Заказ1С = ПТУ[ИмяЗаказа1С];
//			
//			НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПокупателя.СоздатьНаборЗаписей();
//			НаборЗаписей.Отбор.ORDERDATE.Установить(Заказ1С[ДатаЗаказа1С]);
//			НаборЗаписей.Отбор.Организация.Установить(Источник[ИмяОрганизации]);
//			НаборЗаписей.Отбор.Контрагент.Установить(Источник[ИмяКонтрагента]);
//			НаборЗаписей.Отбор.ТочкаДоставки.Установить(Источник[ИмяТочкиДоставки]);
//			НаборЗаписей.Отбор.ORDERNUMBER.Установить(Заказ1С[НомерЗаказа1С]);
//			НаборЗаписей.Отбор.Заказ.Установить(Заказ1С);
//			НаборЗаписей.Отбор.Накладная.Установить(ПТУ);
//			НаборЗаписей.Отбор.Накладная_Кор.Установить(ДокументОснование);
//			
//			//Выполним блокировку данных
//			ВыполнитьБлокировкуНабораЗаписей(НаборЗаписей.Отбор, "ЭКОМ_ЦепочкиДокументовПокупателя");
//			
//			НаборЗаписей.Прочитать();
//			
//			// Если существует запись в регистре
//			Для Каждого НоваяЗапись Из НаборЗаписей Цикл
//				
//				НоваяЗапись.СЧФ_Кор = Источник.Ссылка;
//				НоваяЗапись.СуммаСЧФ_Кор = Источник.СуммаДокумента;
//				НоваяЗапись.НомерИсправления = Источник.НомерИсправления;
//				
//				НаборЗаписей.Записать();
//			КонецЦикла;	
//			
//			// Запись не найдена в цепочке
//			Если НаборЗаписей.Количество() = 0 Тогда
//				Сообщить("Не найден документ Корректировка реализации товаров и услуг или не все измерения заполнены для регистра сведений ""ЭКОМ_ЦепочкиДокументовПоставщика""", СтатусСообщения.ОченьВажное);			
//			КонецЕсли;		
//			
//		КонецЕсли;
		
	КонецЕсли;	