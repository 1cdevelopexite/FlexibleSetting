<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Источник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Приемник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Формула</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Значение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:string">Входящий ORDER</Value>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string"/>
		<Value xsi:nil="true"/>
		<Value xsi:type="xs:string">Если Приемник.xmlВалюта = "RUB" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(643);
ИначеЕсли Приемник.xmlВалюта = "UAH" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(980);
ИначеЕсли Приемник.xmlВалюта = "USD" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(840);
ИначеЕсли Приемник.xmlВалюта = "EUR" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(978);
ИначеЕсли Приемник.xmlВалюта = "MDL" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(498);
ИначеЕсли Приемник.xmlВалюта = "BYR" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(974);
ИначеЕсли Приемник.xmlВалюта = "KZT" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(398);
Иначе
	Валюта = Справочники.Валюты.НайтиПоКоду(643);
КонецЕсли;

Приемник.Валюта = Валюта;
Приемник.Ответственный = ПараметрыСеанса.ТекущийПользователь;

//// Расчет ТЧ Товары
ФорматУПД = м_ПолучитьФорматКонтрагента(Приемник.Контрагент);
ИспользоватьОбратныйПорядокРасчетаСумм = НуженОбратныйРасчетСумм(ФорматУПД);

Для Каждого СтрокаТовары Из Приемник.ТЧ_Товары Цикл	
	
	Если ЗначениеЗаполнено(СтрокаТовары.Цена)  
		И ЗначениеЗаполнено(СтрокаТовары.СтавкаНДС) Тогда
		
		СтавкаНДС = СтрокаТовары.СтавкаНДС;
		СтруктураРасчета = РасчетСумм(СтрокаТовары.Цена, СтрокаТовары.СтавкаНДС, Ложь, СтрокаТовары.КоличествоЗаказанное, 
		ИспользоватьОбратныйПорядокРасчетаСумм);		
	ИначеЕсли ЗначениеЗаполнено(СтрокаТовары.ЦенаСНДС) 
		И ЗначениеЗаполнено(СтрокаТовары.СтавкаНДС) Тогда
		
		СтавкаНДС = СтрокаТовары.СтавкаНДС;
		СтруктураРасчета = РасчетСумм(СтрокаТовары.ЦенаСНДС, СтрокаТовары.СтавкаНДС, Истина, СтрокаТовары.КоличествоЗаказанное, 
		ИспользоватьОбратныйПорядокРасчетаСумм);																						
		
	ИначеЕсли ЗначениеЗаполнено(СтрокаТовары.Цена)
		И ЗначениеЗаполнено(СтрокаТовары.ЦенаСНДС)
		И НЕ ЗначениеЗаполнено(СтрокаТовары.СтавкаНДС) Тогда
		
		СтавкаНДС = Окр(( (СтрокаТовары.ЦенаСНДС / СтрокаТовары.Цена) - 1 ) * 100, 0);
		СтруктураРасчета = РасчетСумм(СтрокаТовары.Цена, СтавкаНДС, Ложь, СтрокаТовары.КоличествоЗаказанное, 
		ИспользоватьОбратныйПорядокРасчетаСумм);			
		
	ИначеЕсли ЗначениеЗаполнено(СтрокаТовары.Цена) 
		И НЕ ЗначениеЗаполнено(СтрокаТовары.СтавкаНДС) Тогда	
		
		СтавкаНДС = СтавкаНДСЧислом(СтрокаТовары.Номенклатура.СтавкаНДС);
		СтруктураРасчета = РасчетСумм(СтрокаТовары.Цена, СтавкаНДС, Ложь, СтрокаТовары.КоличествоЗаказанное, 
		ИспользоватьОбратныйПорядокРасчетаСумм);
		
	ИначеЕсли ЗначениеЗаполнено(СтрокаТовары.ЦенаСНДС) 
		И НЕ ЗначениеЗаполнено(СтрокаТовары.СтавкаНДС) Тогда	
		
		СтавкаНДС = СтавкаНДСЧислом(СтрокаТовары.Номенклатура.СтавкаНДС);
		СтруктураРасчета = РасчетСумм(СтрокаТовары.ЦенаСНДС, СтавкаНДС, Истина, СтрокаТовары.КоличествоЗаказанное, 
		ИспользоватьОбратныйПорядокРасчетаСумм);		
	КонецЕсли;
	
	СтрокаТовары.Цена = СтруктураРасчета.ЦенаБезНДС;
	СтрокаТовары.ЦенаСНДС = СтруктураРасчета.ЦенаСНДС;
	СтрокаТовары.СтавкаНДС = СтавкаНДС;
	СтрокаТовары.Сумма = СтруктураРасчета.СуммаБезНДС;
	СтрокаТовары.Сумма_с_НДС = СтруктураРасчета.СуммаСНДС;
	СтрокаТовары.СуммаНДС = СтруктураРасчета.СуммаНДС;
	
КонецЦикла;
///////////////
Приемник.Записать(РежимЗаписиДокумента.Проведение);

// Регистрация ORDER в цепочке документов поставщика

НаборЗаписей = РегистрыСведений.ЭКОМ_ЦепочкиДокументовПоставщика.СоздатьНаборЗаписей();
НаборЗаписей.Отбор.ORDERDATE.Установить(Приемник.ЗаказДата);
НаборЗаписей.Отбор.ORDERNUMBER.Установить(Приемник.ЗаказНомер);
НаборЗаписей.Отбор.ORDER.Установить(Приемник.Ссылка);

НаборЗаписей.Прочитать();

// Если существует документ в регистре
Для Каждого НоваяЗапись Из НаборЗаписей Цикл
	НоваяЗапись.ДатаПоставки  = Приемник.ДатаПоставки;
	НоваяЗапись.Организация   = Приемник.Организация;
	НоваяЗапись.Контрагент    = Приемник.Контрагент;
	НоваяЗапись.ТочкаДоставки = Приемник.ТочкаДоставки;
	
	НоваяЗапись.КоличествоORDER = Приемник.ТЧ_Товары.Итог("КоличествоЗаказанное");
	НоваяЗапись.СуммаORDER = Приемник.ТЧ_Товары.Итог("Сумма_с_НДС");
КонецЦикла;	

// Записываем документ в первый раз
Если НаборЗаписей.Количество() = 0 Тогда
	НоваяЗапись = НаборЗаписей.Добавить();
	НоваяЗапись.ORDERDATE   = Приемник.ЗаказДата;
	НоваяЗапись.ORDERNUMBER = Приемник.ЗаказНомер;
	НоваяЗапись.ORDER       = Приемник.Ссылка;
	
	НоваяЗапись.xmlОрганизация   = Приемник.xmlОрганизация;
	НоваяЗапись.xmlКонтрагент    = Приемник.xmlКонтрагент;
	НоваяЗапись.xmlТочкаДоставки = Приемник.xmlТочкаДоставки;
	НоваяЗапись.ДатаПоставки     = Приемник.ДатаПоставки;
	НоваяЗапись.Организация      = Приемник.Организация;
	НоваяЗапись.Контрагент       = Приемник.Контрагент;
	НоваяЗапись.ТочкаДоставки    = Приемник.ТочкаДоставки;
	НоваяЗапись.КоличествоORDER  = Приемник.ТЧ_Товары.Итог("КоличествоЗаказанное");
	НоваяЗапись.СуммаORDER       = Приемник.ТЧ_Товары.Итог("Сумма_с_НДС");
КонецЕсли;

НаборЗаписей.Записать();</Value>
		<Value xsi:type="xs:string">Заказы покупателей (ORDER)</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">3</lastId>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>Заказы покупателей (ORDER)</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЭТРН</value>
				<id xsi:type="xs:decimal">3</id>
			</item>
		</Value>
	</row>
</ValueTree>