<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Входящий ORDER</Value>
		<Value xsi:type="xs:string">Заказы покупателей (ORDER)</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">//ВыполнитьГибкиеНастройки(Приемник,,, ЛогСобытий); 

Если Приемник.xmlВалюта = "RUB" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(643);
ИначеЕсли Приемник.xmlВалюта = "UAH" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(980);
ИначеЕсли Приемник.xmlВалюта = "USD" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(840);
ИначеЕсли Приемник.xmlВалюта = "EUR" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(978);
ИначеЕсли Приемник.xmlВалюта = "MDL" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(498);
ИначеЕсли Приемник.xmlВалюта = "BYR" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(974);
ИначеЕсли Приемник.xmlВалюта = "KZT" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(398);
Иначе
	Валюта = Справочники.Валюты.НайтиПоКоду(643);
КонецЕсли;

Приемник.Валюта = Валюта;

Если ВРег(Приемник.ТипДокумента) = "D" Тогда

    Если ЗначениеЗаполнено(Приемник.Документ1С) И ТипЗнч(Приемник.Документ1С) = Тип("ДокументСсылка.ЗаказПокупателя")
        И НЕ Приемник.Документ1С.Проведен Тогда

        ЗаказОбъект = Приемник.Документ1С.ПолучитьОбъект();
        ЗаказОбъект.УстановитьПометкуУдаления(Истина);
    КонецЕсли;

ИначеЕсли  ВРег(Приемник.ТипДокумента) = "R" Тогда

    Если ЗначениеЗаполнено(Приемник.Документ1С) И ТипЗнч(Приемник.Документ1С) = Тип("ДокументСсылка.ЗаказПокупателя")
        И НЕ Приемник.Документ1С.Проведен Тогда

        ЗаказОбъект = Приемник.Документ1С.ПолучитьОбъект();

		//Получим значение настройки ЦеныИз1С для контрагента 
        ЗапросЦеныИз1С = РегистрыСведений.ЭКОМ_GLN.СоздатьМенеджерЗаписи();
        ЗапросЦеныИз1С.Объект = ЗаказОбъект.Контрагент;
        ЗапросЦеныИз1С.Прочитать();
        ЦеныИз1С = ЗапросЦеныИз1С.Контрагент_ЦеныИз1С;
		
		Если ЦеныИз1С Тогда 
	        ЗапросЦен = Новый Запрос;
	        ЗапросЦен.Текст = 
	        "ВЫБРАТЬ
	        |	ЦеныНоменклатурыСрезПоследних.Номенклатура КАК Номенклатура,
	        |	ЕСТЬNULL(ЦеныНоменклатурыСрезПоследних.Цена, 0) КАК Цена
	        |ИЗ
	        |	РегистрСведений.ЦеныНоменклатуры.СрезПоследних(&amp;ДатаЗаказа, ТипЦен = &amp;ТипЦен) КАК ЦеныНоменклатурыСрезПоследних
	        |ГДЕ
	        |	ЦеныНоменклатурыСрезПоследних.Номенклатура В(&amp;Номенклатура)";

	        ЗапросЦен.УстановитьПараметр("ТипЦен", 				ЗаказОбъект.ТипЦен);
	        ЗапросЦен.УстановитьПараметр("ДатаЗаказа", 			Приемник.ЗаказДата);
	        ЗапросЦен.УстановитьПараметр("Номенклатура",		ЗаказОбъект.Товары.ВыгрузитьКолонку("Номенклатура"));

	        РезультатЗапроса = ЗапросЦен.Выполнить();
	        ВыборкаЦен = РезультатЗапроса.Выгрузить();
		КонецЕсли;
		
        ЗаказОбъект.Товары.Очистить();
		
        Для Каждого СтрокаТЧ Из Приемник.ТЧ_Товары Цикл
            ТекущаяСтрока = ЗаказОбъект.Товары.Добавить();

            //ТекущаяСтрока.КоличествоМест	= СтрокаТЧ.КоличествоЗаказанное;
            ТекущаяСтрока.Количество		= СтрокаТЧ.КоличествоЗаказанное;
            Если ЗначениеЗаполнено(СтрокаТЧ.Номенклатура) Тогда

                ТекущаяСтрока.Номенклатура	= СтрокаТЧ.Номенклатура;

                //Получение цены
                Цена = 0;
				Если ЦеныИз1С Тогда 
					СтрокаЦены = ВыборкаЦен.Найти(СтрокаТЧ.Номенклатура, "Номенклатура");
					Цена = ?(СтрокаЦены = Неопределено ИЛИ СтрокаЦены.Цена = 0, СтрокаТЧ.ЦенаСНДС, СтрокаЦены.Цена);
                Иначе
                    Цена = СтрокаТЧ.ЦенаСНДС;
                КонецЕсли;

                ТекущаяСтрока.Цена = Цена;

                Если НЕ СтрокаТЧ.СтавкаНДС = 0 Тогда
                    СтавкаНДС = СтавкаНДССсылка(СтрокаТЧ.СтавкаНДС);
                Иначе
                    СтавкаНДС = СтрокаТЧ.Номенклатура.СтавкаНДС;
                КонецЕсли;

                ТекущаяСтрока.СтавкаНДС = СтавкаНДС; 

                //Пока ставим вид цены Произвольный
                ТекущаяСтрока.ВидЦены = Справочники.ВидыЦен.ПустаяСсылка();

                СтавкаНДС = СтавкаНДСЧислом(ТекущаяСтрока.СтавкаНДС)/100;

                Если ЗаказОбъект.СуммаВключаетНДС Тогда
                    СуммаСНДС = ТекущаяСтрока.Цена * ТекущаяСтрока.Количество;
                    СуммаБезНДС = СуммаСНДС/ (1 + СтавкаНДС);
                    ТекущаяСтрока.СуммаНДС = СуммаБезНДС * СтавкаНДС;    
                    ТекущаяСтрока.Сумма = СуммаСНДС;
                Иначе
                    ТекущаяСтрока.СуммаНДС = ТекущаяСтрока.Цена * ТекущаяСтрока.Количество * СтавкаНДС;
                    ТекущаяСтрока.Сумма = ТекущаяСтрока.Цена * ТекущаяСтрока.Количество;
                КонецЕсли;
            КонецЕсли;    
        КонецЦикла;    

        ЗаказОбъект.Записать(?(ЗаказОбъект.Проведен, РежимЗаписиДокумента.Проведение, РежимЗаписиДокумента.Запись));

    КонецЕсли;    

КонецЕсли;

Если Приемник.НеЗагружатьДокумент = Ложь Тогда
	Приемник.Проведен = Истина;
	Приемник.ПометкаУдаления = Ложь;
КонецЕсли;</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">3</lastId>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>Заказы покупателей (ORDER)</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЭТРН</value>
				<id xsi:type="xs:decimal">3</id>
			</item>
		</Value>
	</row>
</ValueTree>