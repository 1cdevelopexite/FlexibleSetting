<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Входящий ORDER</Value>
		<Value xsi:type="xs:string">Заказы покупателей (ORDER)</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">//ВыполнитьГибкиеНастройки(Приемник,,, ЛогСобытий); 

Если Приемник.xmlВалюта = "RUB" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(643);
ИначеЕсли Приемник.xmlВалюта = "UAH" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(980);
ИначеЕсли Приемник.xmlВалюта = "USD" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(840);
ИначеЕсли Приемник.xmlВалюта = "EUR" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(978);
ИначеЕсли Приемник.xmlВалюта = "MDL" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(498);
ИначеЕсли Приемник.xmlВалюта = "BYR" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(974);
ИначеЕсли Приемник.xmlВалюта = "KZT" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(398);
Иначе
	Валюта = Справочники.Валюты.НайтиПоКоду(643);
КонецЕсли;

Приемник.Валюта = Валюта;

Если ВРег(Приемник.ТипДокумента) = "D"
	ИЛИ ВРег(Приемник.ТипДокумента) = "R" Тогда 
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	ЭКОМ_ЦепочкиДокументовПоставщика.Заказ,
		|	ЭКОМ_GLN.Контрагент_ЦеныИз1С КАК ЦеныИз1С
		|ИЗ
		|	РегистрСведений.ЭКОМ_ЦепочкиДокументовПоставщика КАК ЭКОМ_ЦепочкиДокументовПоставщика
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_GLN КАК ЭКОМ_GLN
		|		ПО ЭКОМ_ЦепочкиДокументовПоставщика.Контрагент = ЭКОМ_GLN.Объект
		|ГДЕ
		|	ЭКОМ_ЦепочкиДокументовПоставщика.ORDERDATE = &amp;ORDERDATE
		|	И ЭКОМ_ЦепочкиДокументовПоставщика.Организация = &amp;Организация
		|	И ЭКОМ_ЦепочкиДокументовПоставщика.Контрагент = &amp;Контрагент
		|	И ЭКОМ_ЦепочкиДокументовПоставщика.ТочкаДоставки = &amp;ТочкаДоставки
		|	И ЭКОМ_ЦепочкиДокументовПоставщика.ORDERNUMBER = &amp;ORDERNUMBER
		|	И НЕ ЭКОМ_ЦепочкиДокументовПоставщика.Заказ.Проведен";
	
	Запрос.УстановитьПараметр("ORDERDATE", 		Приемник.ЗаказДата);
	Запрос.УстановитьПараметр("ORDERNUMBER", 	Приемник.ЗаказНомер);
	Запрос.УстановитьПараметр("Контрагент", 	Приемник.Контрагент);
	Запрос.УстановитьПараметр("Организация", 	Приемник.Организация);
	Запрос.УстановитьПараметр("ТочкаДоставки", 	Приемник.ТочкаДоставки);
	
	РезультатЗапроса 		= Запрос.Выполнить();
	ВыборкаДетальныеЗаписи 	= РезультатЗапроса.Выбрать();
	
	Если ВРег(Приемник.ТипДокумента) = "D" Тогда

		Если ВыборкаДетальныеЗаписи.Следующий() Тогда
			ЗаказОбъект = ВыборкаДетальныеЗаписи.Заказ.ПолучитьОбъект();
	        ЗаказОбъект.УстановитьПометкуУдаления(Истина);
		КонецЕсли;

	ИначеЕсли ВРег(Приемник.ТипДокумента) = "R" Тогда

		Если ВыборкаДетальныеЗаписи.Следующий() Тогда
			
			мВалютаРегламентированногоУчета 	= глЗначениеПеременной("ВалютаРегламентированногоУчета");
			ЗаказОбъект = ВыборкаДетальныеЗаписи.Заказ.ПолучитьОбъект();
	        ЗаказОбъект.Товары.Очистить();
			
	        Для Каждого СтрокаТЧ Из Приемник.ТЧ_Товары Цикл
				СтрокаТабличнойЧасти = ЗаказОбъект.Товары.Добавить();
				// Заполнение данных строки.
		        ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, СтрокаТЧ, "Номенклатура, ЕдиницаИзмерения");
				СтрокаТабличнойЧасти.Количество 	= СтрокаТЧ.КоличествоПоставляемое;
				СтрокаТабличнойЧасти.Коэффициент 	= СтрокаТЧ.ЕдиницаИзмерения.Коэффициент;
				ОбработкаТабличныхЧастей.ЗаполнитьСтавкуНДСТабЧасти(СтрокаТабличнойЧасти, ЗаказОбъект, "Реализация");
				СтрокаТабличнойЧасти.Размещение 	= ЗаказОбъект.СкладГруппа;
				
				Если ВыборкаДетальныеЗаписи.ЦеныИз1С Тогда
					ОбработкаТабличныхЧастей.ЗаполнитьЕдиницуЦенуПродажиТабЧасти(СтрокаТабличнойЧасти, ЗаказОбъект, мВалютаРегламентированногоУчета);
				Иначе
					Цена = 0;
			        Если ЗаказОбъект.СуммаВключаетНДС И ЗначениеЗаполнено(СтрокаТЧ.ЦенаСНДС) Тогда
			            Цена = СтрокаТЧ.ЦенаСНДС;
			        ИначеЕсли НЕ ЗаказОбъект.СуммаВключаетНДС И ЗначениеЗаполнено(СтрокаТЧ.Цена) Тогда
			            Цена = СтрокаТЧ.Цена;
			        ИначеЕсли ЗаказОбъект.СуммаВключаетНДС И ЗначениеЗаполнено(СтрокаТЧ.Цена) Тогда
			            Цена  = Окр((СтрокаТЧ.Цена * (100 + СтавкаНДСЧислом(СтрокаТабличнойЧасти.СтавкаНДС))) / 100 , 4);
			        ИначеЕсли НЕ ЗаказОбъект.СуммаВключаетНДС И ЗначениеЗаполнено(СтрокаТЧ.ЦенаСНДС) Тогда
			            Цена = Окр((СтрокаТЧ.ЦенаСНДС * 100) / (100 + СтавкаНДСЧислом(СтрокаТабличнойЧасти.СтавкаНДС)) , 4);
			        КонецЕсли;
			        СтрокаТабличнойЧасти.Цена = Цена;
				КонецЕсли;
				
				ОбработкаТабличныхЧастей.РассчитатьСуммуТабЧасти(СтрокаТабличнойЧасти, ЗаказОбъект);
				ОбработкаТабличныхЧастей.РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЗаказОбъект);
				// Рассчитываем плановую себестоимость.
				ОбработкаТабличныхЧастей.РассчитатьПлановуюСебестоимостьВСтрокеТабЧасти(СтрокаТабличнойЧасти, ЗаказОбъект, мВалютаРегламентированногоУчета);
	        КонецЦикла;    

	        ЗаказОбъект.Записать(?(ЗаказОбъект.Проведен, РежимЗаписиДокумента.Проведение, РежимЗаписиДокумента.Запись));
			
		КонецЕсли;

	КонецЕсли;
	
КонецЕсли;

Если Приемник.НеЗагружатьДокумент = Ложь Тогда
	Приемник.Проведен = Истина;
	Приемник.ПометкаУдаления = Ложь;
КонецЕсли;</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">3</lastId>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>Заказы покупателей (ORDER)</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЭТРН</value>
				<id xsi:type="xs:decimal">3</id>
			</item>
		</Value>
	</row>
</ValueTree>