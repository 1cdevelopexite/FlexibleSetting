<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Входящий ORDER</Value>
		<Value xsi:type="xs:string">//ВыполнитьГибкиеНастройки(Приемник,,, ЛогСобытий); 

// Новый вариант для использования при создании ЭКОМ_Документа
Если Приемник.xmlВалюта = "UAH" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(980);
ИначеЕсли Приемник.xmlВалюта = "RUB" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(643);
ИначеЕсли Приемник.xmlВалюта = "USD" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(840);
ИначеЕсли Приемник.xmlВалюта = "EUR" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(978);
ИначеЕсли Приемник.xmlВалюта = "MDL" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(498);
ИначеЕсли Приемник.xmlВалюта = "BYR" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(974);
ИначеЕсли Приемник.xmlВалюта = "KZT" Тогда
	Валюта = Справочники.Валюты.НайтиПоКоду(398);
Иначе
	Валюта = Справочники.Валюты.НайтиПоКоду(643);
КонецЕсли;

Приемник.Валюта = Валюта;

Если ВРег(Приемник.ТипДокумента) = "D" Тогда
	Приемник.Комментарий = ?(ЗначениеЗаполнено(Приемник.Комментарий), Приемник.Комментарий + Символы.ПС, "") + "Заказ отменен!";
	Если ЗначениеЗаполнено(Приемник.Документ1С) И ТипЗнч(Приемник.Документ1С) = Тип("ДокументСсылка.ЗаказКлиента")
		И НЕ Приемник.Документ1С.Проведен Тогда
		
		ЗаказОбъект = Приемник.Документ1С.ПолучитьОбъект();
		ЗаказОбъект.УстановитьПометкуУдаления(Истина);
	КонецЕсли;
	
ИначеЕсли  ВРег(Приемник.ТипДокумента) = "R" Тогда
	
	Приемник.Комментарий = ?(ЗначениеЗаполнено(Приемник.Комментарий), Приемник.Комментарий + Символы.ПС, "") + "Заказ обновлен!";
	Если ЗначениеЗаполнено(Приемник.Документ1С) И ТипЗнч(Приемник.Документ1С) = Тип("ДокументСсылка.ЗаказКлиента")
		И НЕ Приемник.Документ1С.Проведен Тогда
		
		ЗаказОбъект = Приемник.Документ1С.ПолучитьОбъект();
		
		//Получение цены
		//Получим значение настройки ЦеныИз1С для контрагента 
		ЗапросЦеныИз1С = РегистрыСведений.ЭКОМ_GLN.СоздатьМенеджерЗаписи();
		ЗапросЦеныИз1С.Объект = ЗаказОбъект.Контрагент;
		ЗапросЦеныИз1С.Прочитать();
		ЦеныИз1С  = ЗапросЦеныИз1С.Контрагент_ЦеныИз1С;
		
		ЗаказОбъект.Товары.Очистить();

		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЭКОМ_ДокументыТЧ_Товары.Номенклатура КАК Номенклатура,
		|	ЦеныНоменклатурыСрезПоследних.Цена КАК ЦенаИз1С,
		|	ЭКОМ_ДокументыТЧ_Товары.КоличествоЗаказанное КАК КоличествоЗаказанное,
		|	ЭКОМ_ДокументыТЧ_Товары.ЦенаСНДС КАК ЦенаСНДС,
		|	ЭКОМ_ДокументыТЧ_Товары.СтавкаНДС КАК СтавкаНДС
		|ИЗ
		|	Документ.ЭКОМ_Документы.ТЧ_Товары КАК ЭКОМ_ДокументыТЧ_Товары
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры.СрезПоследних(&amp;ДатаЗаказа, ТипЦен = &amp;ТипЦен) КАК ЦеныНоменклатурыСрезПоследних
		|		ПО ЭКОМ_ДокументыТЧ_Товары.Номенклатура = ЦеныНоменклатурыСрезПоследних.Номенклатура
		|ГДЕ
		|	ЭКОМ_ДокументыТЧ_Товары.Ссылка = &amp;Ссылка";
		
		Запрос.УстановитьПараметр("ТипЦен"    , ЗаказОбъект.ДоговорКонтрагента.ТипЦен);
		Запрос.УстановитьПараметр("ДатаЗаказа", Приемник.ЗаказДата);
		Запрос.УстановитьПараметр("Ссылка"    , Приемник.Ссылка);
		
		РезультатЗапроса = Запрос.Выполнить();
		
		Выборка = РезультатЗапроса.Выбрать();		
		Пока Выборка.Следующий() Цикл
			ТекущаяСтрока = ЗаказОбъект.Товары.Добавить();
			ТекущаяСтрока.КоличествоУпаковок = Выборка.КоличествоЗаказанное;
			ТекущаяСтрока.Количество         = Выборка.КоличествоЗаказанное;
            ТекущаяСтрока.Номенклатура       = Выборка.Номенклатура;
			Цена = 0;
			Если ЦеныИз1С = Истина Тогда
				Цена = Выборка.ЦенаИз1С;
				Если Цена = 0 
					ИЛИ Цена = NULL Тогда
					Цена = Выборка.ЦенаСНДС;
				КонецЕсли;
			Иначе
				Цена = Выборка.ЦенаСНДС;
			КонецЕсли;
			
			ТекущаяСтрока.Цена = Цена;	
			Если НЕ Выборка.СтавкаНДС = 0 Тогда
				СтавкаНДС = СтавкаНДССсылка(Выборка.СтавкаНДС);
			Иначе
				СтавкаНДС = Выборка.Номенклатура.СтавкаНДС;
			КонецЕсли;		
			ТекущаяСтрока.СтавкаНДС    = СтавкаНДС; 	
				
			//Пока ставим вид цены Произвольный
			ТекущаяСтрока.ТипЦен = Справочники.ВидыЦен.ПустаяСсылка();		
			СтавкаНДС = СтавкаНДСЧислом(ТекущаяСтрока.СтавкаНДС)/100;		
			Если ЗаказОбъект.СуммаВключаетНДС Тогда
				СуммаСНДС = ТекущаяСтрока.Цена * ТекущаяСтрока.КоличествоУпаковок;
				СуммаБезНДС = СуммаСНДС/ (1 + СтавкаНДС);
				ТекущаяСтрока.СуммаНДС  = СуммаБезНДС * СтавкаНДС;    
				ТекущаяСтрока.Сумма     = СуммаСНДС;
				ТекущаяСтрока.СуммаСНДС = СуммаСНДС;
			Иначе
				ТекущаяСтрока.СуммаНДС  = ТекущаяСтрока.Цена * ТекущаяСтрока.КоличествоУпаковок * СтавкаНДС;
				ТекущаяСтрока.Сумма     = ТекущаяСтрока.Цена * ТекущаяСтрока.КоличествоУпаковок;
				ТекущаяСтрока.СуммаСНДС = ТекущаяСтрока.Сумма + ТекущаяСтрока.СуммаНДС;
			КонецЕсли;
		
		КонецЦикла;
		    
		ЗаказОбъект.Записать(?(ЗаказОбъект.Проведен, РежимЗаписиДокумента.Проведение, РежимЗаписиДокумента.Запись));
		
	КонецЕсли;    
	
КонецЕсли;

Если Приемник.НеЗагружатьДокумент = Ложь Тогда
	Приемник.Проведен = Истина;
	Приемник.ПометкаУдаления = Ложь;
КонецЕсли;</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">Заказы покупателей (ORDER)</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">3</lastId>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>Заказы покупателей (ORDER)</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЭТРН</value>
				<id xsi:type="xs:decimal">3</id>
			</item>
		</Value>
	</row>
</ValueTree>